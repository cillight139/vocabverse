<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Werse词境 数据</title>
    <script src="js/jquery-3.7.0.min.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/axios-0.18.0.js"></script>
    <link rel="icon" href="image/logo-white.png">
    <link rel="stylesheet" href="css/top-nav.css">
    <link rel="stylesheet" href="css/public/main.css">
    <link rel="stylesheet" href="css/index_04.css">
    <style>
        .avatar_border_active {
            border: 4px #00e57b solid;
        }

        /*弹出框动效*/
        .MessageBoxBorderFrames {
            animation: MessageBoxBorderFrames 0.3s linear;
        }

        /*v-if动画*/
        .fade-enter-active, .fade-leave-active {
            transition: opacity .5s;
        }

        .fade-enter, .fade-leave-to {
            opacity: 0;
        }

        .updateConfirmBtnBackColor_visiable {
            background-color: #00e57b;
        }

        .updateConfirmBtnBackColor_invisiable {
            background-color: #858585;
        }

        .updateBtn {
            cursor: not-allowed;
            background-color: #858585;
        }

        .updateBtn_active {
            cursor: pointer;
            background-color: #00e57b;
        }

        .updateBtn_active:hover {
            background-color: #1aff96;
        }
    </style>
</head>
<body>
<!--通知-->
<div id="notification" class="public_notification_div">
    <div class="public_notification_title">
        <div v-if="no_type==='error'" class="notification_item_tittle">
            <img :src="spantype.error.src">
            <span>{{spantype.error.value}}</span>
        </div>
        <div v-if="no_type==='message'" class="notification_item_tittle">
            <img :src="spantype.message.src">
            <span>{{spantype.message.value}}</span>
        </div>
        <div v-if="no_type==='warn'" class="notification_item_tittle">
            <img :src="spantype.warn.src">
            <span>{{spantype.warn.value}}</span>
        </div>
        <div v-if="no_type==='success'" class="notification_item_tittle">
            <img :src="spantype.success.src">
            <span>{{spantype.success.value}}</span>
        </div>
    </div>
    <div class="public_notification_content">{{no_content}}</div>
</div>
<!--弹窗-->
<div id="MessageBoxContent" class="MessageBoxDiv" @click="tipEffection">
    <div id="messageBox" class="MessageBox" :class="{'MessageBoxBorderFrames':borderFramesValue}"
         @animationend="tipEffectionEnd">
        <div class="MessageBoxContent">{{messageBoxQuestion}}</div>
        <div class="MessageBoxController">
            <span @click.stop="messageBoxConfirmBtn(true)">确认</span>
            <span @click.stop="messageBoxConfirmBtn(false)">取消</span>
        </div>
    </div>
</div>
<!-- 顶部导航栏，三个元素 -->
<div class="top-nav">
    <div class="index-logo">
        <a href="homePage" class="index_logo_a">
            <img class="logo_img" src="image/topnav/topnavlogo.png" alt="Werse">
            <h2 class="logo_h2_e">e</h2>
            <h2 class="logo_h2_r">r</h2>
            <h2 class="logo_h2_s">s</h2>
            <h2 class="logo_h2_e1">e</h2>
        </a>
    </div>
    <div class="nav-content">
        <a href="homePage"><span>首页</span></a>
        <a href="studyPage"><span>学习</span></a>
        <a><span>查</span><span>-</span><span>译</span></a>
        <div class="cha_yi_div">
            <a href="searchWordPage">查词</a>
            <a href="translatePage">翻译</a>
        </div>
        <a href="wersebotPage"><span>WerseBot</span></a>
        <a href="dataPage"
           style="color: #00e57b;box-sizing: border-box;border-top: 3px #00e57b solid;"><span>数据</span></a>
    </div>
    <div class="more-nav">


    </div>
</div>
<!--修改卡片-->
<div v-if="cardShowValue" id="updateCardApp" class="user_data_update_card_div">
    <div class="user_data_update_card">
        <!--标题-->
        <div class="update_card_title_div">
            <span class="update_card_title_span">{{cardTitle}}</span>
            <span @click="closeUpdateCard" class="close_update_card_div_btn"></span>
        </div>
        <!--修改头像-->
        <div v-if="updateCategory==='avatar'" style="margin-top: 50px">
            <div style="display: flex;justify-content: center;">
                <div style="width: 490px; background-color: #1e1e1e;padding-top: 20px;padding-bottom: 20px; display:flex;justify-content: center;flex-direction: column;align-items: center;position: fixed">
                    <img v-if="newUpdateValue.length===0" style="width: 70px;height: 70px" :src="dataValue" alt="头像">
                    <img v-else style="width: 70px;height: 70px" :src="newUpdateValue" alt="头像">
                    <div class="uploadAvatarBtn_div">
                        <span class="updateBtn_active">上传头像</span>
                        <span :class="(newUpdateValue===dataValue)||(newUpdateValue.length===0)? 'updateBtn':'updateBtn_active'"
                              @click="updateConfirmBtn">确定</span>
                    </div>
                </div>

            </div>
            <div style="z-index: 999;display: flex;justify-content: left;flex-wrap: wrap;padding: 180px 21px 20px;min-width: 497px">
                <img :id="item.url" @click="avatarImgBtn(item.url)" class="update_avatar_img"
                     v-for="(item,index) in avatarUrl" :src="item.url" alt="gif">
            </div>
        </div>
        <!--修改简介-->
        <div v-if="updateCategory==='synopsis'" style="margin-top: 50px;">
            <div @click="updateConfirmBtn()"
                 :class="(newUpdateValue===dataValue)||(newUpdateValue.length===0)? 'updateBtn':'updateBtn_active' "
                 class="user_data_update_confirm_btn">
                保存
            </div>
            <div class="user_data_update_synopsis_content">
                <h4>简介：</h4>
                <textarea type="text" maxlength="70" autocomplete="off" spellcheck="false" placeholder="请填写你的签名。"
                          v-model="newUpdateValue"></textarea>
                <div style="color: whitesmoke;float: right;">{{newUpdateValue.length}}/70</div>
            </div>
        </div>
        <!--修改昵称 地区 学校-->
        <div v-if="updateCategory==='nickname'||updateCategory==='region'||updateCategory==='school'"
             style="margin-top: 50px;">
            <div @click="updateConfirmBtn()"
                 :class="(newUpdateValue===dataValue)||(newUpdateValue.length===0)? 'updateBtn':'updateBtn_active' "
                 class="user_data_update_confirm_btn">
                保存
            </div>
            <div class="user_data_update_synopsis_content">
                <h4 v-if="updateCategory==='nickname'">昵称：</h4>
                <h4 v-if="updateCategory==='region'">地区：</h4>
                <h4 v-if="updateCategory==='school'">学校：</h4>
                <input type="text" maxlength="15" autocomplete="off" spellcheck="false" placeholder="请填写你的信息"
                       v-model="newUpdateValue">
            </div>
        </div>
        <!--修改手机号-->
        <div v-if="updateCategory==='phonenumber'" style="margin-top: 50px;">
            <div @click="updateConfirmBtn()"
                 :class="(newUpdateValue===dataValue)||(newUpdateValue.length===0)? 'updateBtn':'updateBtn_active' "
                 class="user_data_update_confirm_btn">
                保存
            </div>
            <div class="user_data_update_synopsis_content">
                <h4>手机号：</h4>
                <input type="number" oninput="if(value>19999999999)value=19999999999" autocomplete="off"
                       placeholder="请填写你的信息"
                       v-model="newUpdateValue">
            </div>
        </div>
        <!--修改性别-->
        <div v-if="updateCategory==='gender'" style="margin-top: 50px;">
            <div @click="updateConfirmBtn()"
                 :class="(newUpdateValue===dataValue)||(newUpdateValue.length===0)? 'updateBtn':'updateBtn_active' "
                 class="user_data_update_confirm_btn">
                保存
            </div>
            <div class="user_data_update_synopsis_content">
                <h4>性别：</h4>
                <div style="display: flex;justify-content: center;">
                    <img :src="updateCardGenderImgUrl" style="width: 70px;height: 70px;margin-top: 20px;display: block">
                </div>
                <div class="gender_select_div">
                    <span @click="selectGenderBtn(2)"
                          :class="newUpdateValue===2? 'updateBtn_active':'updateBtn'">外星人</span>
                    <span @click="selectGenderBtn(1)"
                          :class="newUpdateValue===1? 'updateBtn_active':'updateBtn'">男孩</span>
                    <span @click="selectGenderBtn(0)"
                          :class="newUpdateValue===0? 'updateBtn_active':'updateBtn'">女孩</span>
                </div>
            </div>
        </div>
        <!--修改生日-->
        <div v-if="updateCategory==='birthday'" style="margin-top: 50px;">
            <div @click="updateBirthdayConfirmBtn()"
                 :class="(newUpdateValue===dataValue)||(newUpdateValue.length===0)? 'updateBtn':'updateBtn_active' "
                 class="user_data_update_confirm_btn">
                保存
            </div>
            <div class="date_select__div">
                <h4>生日：</h4>
                <div class="data_select_picker_title">
                    <span>年</span>
                    <span>月</span>
                    <span>日</span>
                </div>
                <div class="data_select_picker_div">
                    <span id="picker_year_column" class="picker_year_column_span"
                          @mousedown="setPointerDownTrue('year')"
                          @mousemove="selectYearMove('year')"
                          @mouseup="setPointerDownFalse('year')" @mouseleave="setPointerDownFalse('year')">
                        <li :id="'picker_year_item_'+index" class="picker_year_item"
                            v-for="(item,index) in picker_years">{{item}}</li>
                    </span>
                    <span class="picker_month_column_span" id="picker_month_column"
                          @mousedown="setPointerDownTrue('month')"
                          @mousemove="selectYearMove('month')"
                          @mouseup="setPointerDownFalse('month')" @mouseleave="setPointerDownFalse('month')">
                        <li class="picker_month_item" v-for="item in picker_months">{{item}}</li>
                    </span>
                    <span class="picker_day_column_span" id="picker_day_column"
                          @mousedown="setPointerDownTrue('day')"
                          @mousemove="selectYearMove('day')"
                          @mouseup="setPointerDownFalse('day')" @mouseleave="setPointerDownFalse('day')">
                        <li class="picker_day_item" v-for="item in picker_days">{{item}}</li>
                    </span>
                    <div class="selector_div"></div>

                </div>

            </div>

        </div>

    </div>
</div>
<!--内容-->
<div class="content-body">
    <div class="content-div">
        <div class="data_body_content" id="userDataApp">
            <!--左侧-->
            <!--我的信息-->
            <transition name="fade">
                <div v-if="cardStateValue==='allInformation'" class="user_data_div">
                    <!--头像 名字 性别-->
                    <div class="user_data_content">
                        <div style="width: 100%;display: flex">
                            <div class="user_data_avatar">
                                <img :src="user.avatar" alt="头像">
                            </div>
                            <div class="user_data_name_sex_level_uid">
                                <h4>{{user.nickname}}</h4>
                                <div class="user_data_sex_level_uid">
                                    <span v-if="user.gender===0" class="user_sex_female"></span>
                                    <span v-else-if="user.gender===1" class="user_sex_male"></span>
                                    <span v-else class="user_sex_alien"></span>
                                    <span class="user_level">LVL{{user.level}}</span>
                                    <span class="user_uid">UID:{{user.userid}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="user_other_data_div">
                            <!--签名-->
                            <div class="user_synopsis">
                                签名：{{user.synopsis === null ? "你还没有签名，快去写个签名吧。" : user.synopsis}}
                            </div>
                            <div class="user_other_data_item">
                                <span>生日：</span>
                                <span>{{user.birthday === null ? "无" : user.birthday}}</span>
                            </div>
                            <div class="user_other_data_item">
                                <span>学校：</span>
                                <span>{{user.school === null ? "无" : user.school}}</span>
                            </div>
                            <div class="user_other_data_item">
                                <span>地区：</span>
                                <span>{{user.region === null ? "无" : user.region}}</span>
                            </div>
                            <div class="user_other_data_item">
                                <span>邮箱：</span>
                                <span>{{user.useremail}}</span>
                            </div>
                            <div class="user_other_data_item">
                                <span>手机：</span>
                                <span>{{user.phonenumber === null ? "无" : user.phonenumber}}</span>
                            </div>
                            <div class="user_other_data_item">
                                <span>注册时间：</span>
                                <span>{{user.regtime === null ? "无" : user.regtime}}</span>
                            </div>

                        </div>
                    </div>
                    <!--底部控制-->
                    <div class="user_data_control_div">
                        <div class="user_data_update_div">
                            <div @click="updateInformationBtn">修改信息</div>
                            <div @click="updatePasswordBtn">修改密码</div>
                        </div>
                        <div class="loginOut_div" @click="loginOut">
                            <span class="loginOuText">注销登录</span>
                            <span class="loginOutImg"></span>
                        </div>
                    </div>

                </div>
            </transition>
            <!--修改信息-->
            <transition name="fade">
                <div v-if="cardStateValue==='updateInformation'" class="user_update_data_div">
                    <div style="display:flex;justify-content: space-between;border-bottom: 2px #626262 solid;padding-bottom: 10px">
                        <div @click="updateBackBtn" class="update_information_div_back_btn">
                            <span class="update_information_div_back_btn_img"></span>返回
                        </div>
                        <div style="color:#a8a8a8;display: flex;align-items: center"><img
                                style="width: 20px;height: 20px;margin: 0;padding: 0" src="image/index_04/tip_icon.png"
                                alt=""> 点击单项更改
                        </div>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('avatar',user.avatar)">
                        <div style="color: #ffffff;font-weight: 600;font-size: 1em;">头像</div>
                        <img :src="user.avatar" alt="">
                        <span></span>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('synopsis',user.synopsis)">
                        <div class="update_user_data_item_jianjie">
                            <div>简介：</div>
                            <div>{{user.synopsis === null ? "无" : user.synopsis}}</div>
                        </div>
                        <span></span>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('nickname',user.nickname)">
                        <div class="update_user_data_item_left">
                            <span>昵称：</span>
                            <span>{{user.nickname === null ? "无" : user.nickname}}</span>
                        </div>
                        <span></span>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('gender',user.gender)">
                        <div class="update_user_data_item_left">
                            <span>性别：</span>
                            <span v-if="user.gender===0">女</span>
                            <span v-else-if="user.gender===1">男</span>
                            <span v-else>外星人</span>
                        </div>
                        <span></span>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('birthday',user.birthday)">
                        <div class="update_user_data_item_left">
                            <span>生日：</span>
                            <span>{{user.birthday === null ? "无" : user.birthday}}</span>
                        </div>
                        <span></span>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('phonenumber',user.phonenumber)">
                        <div class="update_user_data_item_left">
                            <span>手机：</span>
                            <span>{{user.phonenumber === null ? "无" : user.phonenumber}}</span>
                        </div>
                        <span></span>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('school',user.school)">
                        <div class="update_user_data_item_left">
                            <span>学校：</span>
                            <span>{{user.school === null ? "无" : user.school}}</span>
                        </div>
                        <span></span>
                    </div>
                    <div class="update_user_data_item" @click="updateItemDataBtn('region',user.region)">
                        <div class="update_user_data_item_left">
                            <span>地区：</span>
                            <span>{{user.region === null ? "无" : user.region}}</span>
                        </div>
                        <span></span>
                    </div>


                </div>
            </transition>
            <!--修改密码-->
            <transition name="fade">
                <div v-if="cardStateValue==='updatePassword'" class="user_data_div">
                    <!--头像 名字 性别-->
                    <div style="width: auto">
                        <div @click="updateBackBtn" class="update_information_div_back_btn">
                            <span class="update_information_div_back_btn_img"></span>返回
                        </div>
                        <div class="update_password_input_div">
                            <h4>旧密码</h4>
                            <input v-model="oldPassword" onkeyup="value=value.replace(/[^\w\.\/]/ig,'')" maxlength="16"
                                   type="password"
                                   placeholder="请输入旧密码">
                            <h4 style="margin-top: 20px">新密码</h4>
                            <input v-model="newPassword1" onkeyup="value=value.replace(/[^\w\.\/]/ig,'')" maxlength="16"
                                   type="password" placeholder="请设置新密码(密码长度6-16位)">
                            <input v-model="newPassword2" onkeyup="value=value.replace(/[^\w\.\/]/ig,'')"
                                   style="margin-top: 10px" maxlength="16" type="password"
                                   placeholder="请再次输入新密码">
                        </div>
                        <div class="update_password_message_div">{{updateMessage}}</div>
                    </div>
                    <!--底部控制-->
                    <div class="update_password_btn" @click="updatePasswordConfirmBtn">确认更改</div>
                </div>
            </transition>
            <!--右侧-->
            <div class="user_study_data_div">

            </div>


        </div>
    </div>
</div>


<script>


    /*我的信息*/
    const userDataApp = new Vue({
        el: "#userDataApp",
        data: {

            user: [],
            cardStateValue: "allInformation",  //左侧显示状态  allInformation  updateInformation   updatePassword
            updateMessage: "",//提示消息
            /*修改密码 data*/
            oldPassword: "",
            newPassword1: "",
            newPassword2: "",
            passwordUpdateState: false  //是否成功修改密码
        },
        created() {
            this.fetchUserInformationAxios()
        },
        methods: {
            /*点击某一项 打开修改卡*/
            updateItemDataBtn(category, value) {
                updateCardApp.openUpdateCard(category, value);
            },
            /*获取我的个人所有信息*/
            fetchUserInformationAxios() {
                let _this = this
                axios({
                    method: "get",
                    url: "search/findUserById"
                }).then(function (data) {
                    _this.user = data.data
                });
            },
            /*修改信息按钮*/
            updateInformationBtn() {
                this.cardStateValue = "updateInformation"
            },
            /*修改返回顶部返回按钮*/
            updateBackBtn() {
                this.updateMessage = ""
                this.newPassword1 = ""
                this.newPassword2 = ""
                this.oldPassword = ""
                this.cardStateValue = "allInformation"
            },
            /*修改密码按钮*/
            updatePasswordBtn() {
                this.cardStateValue = "updatePassword"
            },
            /*确认修改密码按钮*/
            updatePasswordConfirmBtn() {
                if (this.oldPassword.length === 0) {
                    this.updateMessage = "请输入你的旧密码"
                    return null
                } else if (this.newPassword1.length === 0 || this.newPassword2.length === 0) {
                    this.updateMessage = "请输入你的新密码"
                    return null
                } else if ((this.newPassword1.length < 6 || this.newPassword1.length > 16) || (this.newPassword2.length < 6 || this.newPassword2.length > 16)) {
                    this.updateMessage = "密码须为6-16位"
                    return null
                } else if (this.newPassword1 !== this.newPassword2) {
                    this.updateMessage = "两次新密码不一致"
                    return null
                } else {
                    //axios
                    let _this = this
                    axios({
                        method: "post",
                        url: "register/updatePassword?oldPassword=" + _this.oldPassword + "&newPassword1=" + _this.newPassword1
                    }).then(function (data) {
                        if (data.data === '密码更改成功') {
                            _this.newPassword1 = ""
                            _this.newPassword2 = ""
                            _this.oldPassword = ""
                        }
                        _this.updateMessage = data.data
                    })
                }
            },
            /*注销登录按钮*/
            loginOut() {
                let _this = this
                MessageBoxVue.openMessageBox("你确定要注销登录吗？")
                let r = new Promise((resolve) => {
                    let timer = setInterval(() => {   //定时器
                        let messageBoxConfirmValue = window.sessionStorage.getItem("messageBoxConfirmValue")
                        if (messageBoxConfirmValue !== "null") {
                            clearInterval(timer)
                            resolve(messageBoxConfirmValue)
                        }
                    }, 100)
                })
                r.then(async (res) => {
                    if (res === "true") {
                        //确认操作逻辑
                        sessionStorage.clear()  //清楚所有前端session
                        await axios({  //清除后端session与cookie
                            method: "get",
                            url: "register/loginOut"
                        }).then(function (data) {
                            if (data.data === true) {
                                window.location.replace('registerPage');
                            }
                        });
                    }
                })


            },
        }

    })
    /*修改数据卡*/
    const updateCardApp = new Vue({
        el: "#updateCardApp",
        data: {
            avatarUrl: [
                {url: "image/avatar/gif/101.gif"},
                {url: "image/avatar/gif/102.gif"},
                {url: "image/avatar/gif/103.gif"},
                {url: "image/avatar/gif/104.gif"},
                {url: "image/avatar/gif/105.gif"},
                {url: "image/avatar/gif/106.gif"},
                {url: "image/avatar/gif/107.gif"},
                {url: "image/avatar/gif/108.gif"},
                {url: "image/avatar/gif/109.gif"},
                {url: "image/avatar/gif/110.gif"},
                {url: "image/avatar/gif/111.gif"},
                {url: "image/avatar/gif/112.gif"},
                {url: "image/avatar/gif/113.gif"},
                {url: "image/avatar/gif/114.gif"},
                {url: "image/avatar/gif/115.gif"},
                {url: "image/avatar/gif/116.gif"},
                {url: "image/avatar/gif/117.gif"},
                {url: "image/avatar/gif/118.gif"},
                {url: "image/avatar/gif/119.gif"},
                {url: "image/avatar/gif/120.gif"},
                {url: "image/avatar/gif/121.gif"},
                {url: "image/avatar/gif/122.gif"},
                {url: "image/avatar/gif/123.gif"},
                {url: "image/avatar/gif/124.gif"},
                {url: "image/avatar/gif/125.gif"},
                {url: "image/avatar/gif/126.gif"},
                {url: "image/avatar/gif/127.gif"},
                {url: "image/avatar/gif/128.gif"},
                {url: "image/avatar/gif/129.gif"},
                {url: "image/avatar/gif/130.gif"},
                {url: "image/avatar/gif/131.gif"},
                {url: "image/avatar/gif/132.gif"},
                {url: "image/avatar/gif/133.gif"},
                {url: "image/avatar/gif/134.gif"},
                {url: "image/avatar/gif/135.gif"},
                {url: "image/avatar/gif/136.gif"},
                {url: "image/avatar/gif/137.gif"},
                {url: "image/avatar/gif/138.gif"},
                {url: "image/avatar/gif/139.gif"},
                {url: "image/avatar/gif/140.gif"},
                {url: "image/avatar/gif/141.gif"},
                {url: "image/avatar/gif/142.gif"},
                {url: "image/avatar/gif/143.gif"},
                {url: "image/avatar/gif/144.gif"},
                {url: "image/avatar/gif/145.gif"},
                {url: "image/avatar/gif/146.gif"},
                {url: "image/avatar/gif/147.gif"},
                {url: "image/avatar/gif/148.gif"},
                {url: "image/avatar/gif/149.gif"},
                {url: "image/avatar/gif/150.gif"},
                {url: "image/avatar/gif/151.gif"},
                {url: "image/avatar/gif/152.gif"},
                {url: "image/avatar/gif/153.gif"},
                {url: "image/avatar/gif/154.gif"},
                {url: "image/avatar/gif/155.gif"},
                {url: "image/avatar/gif/156.gif"},
                {url: "image/avatar/gif/157.gif"},
                {url: "image/avatar/gif/158.gif"},
                {url: "image/avatar/gif/159.gif"},
                {url: "image/avatar/gif/160.gif"},
                {url: "image/avatar/gif/161.gif"},
                {url: "image/avatar/gif/162.gif"},
                {url: "image/avatar/gif/163.gif"},
                {url: "image/avatar/gif/164.gif"},
                {url: "image/avatar/gif/165.gif"},
                {url: "image/avatar/gif/166.gif"},
                {url: "image/avatar/gif/167.gif"},
                {url: "image/avatar/gif/168.gif"},
                {url: "image/avatar/gif/169.gif"},
                {url: "image/avatar/gif/170.gif"},
                {url: "image/avatar/gif/171.gif"},
                {url: "image/avatar/gif/172.gif"},
                {url: "image/avatar/gif/173.gif"},
                {url: "image/avatar/gif/174.gif"},
                {url: "image/avatar/gif/175.gif"},
                {url: "image/avatar/gif/176.gif"},
                {url: "image/avatar/gif/177.gif"},
                {url: "image/avatar/gif/178.gif"},
                {url: "image/avatar/gif/179.gif"},
                {url: "image/avatar/gif/180.gif"},
                {url: "image/avatar/gif/181.gif"},
                {url: "image/avatar/gif/182.gif"},
                {url: "image/avatar/gif/183.gif"},
                {url: "image/avatar/gif/184.gif"},
                {url: "image/avatar/gif/185.gif"},
                {url: "image/avatar/gif/186.gif"},
                {url: "image/avatar/gif/187.gif"},
                {url: "image/avatar/gif/188.gif"},
                {url: "image/avatar/gif/189.gif"},
                {url: "image/avatar/gif/190.gif"},
                {url: "image/avatar/gif/191.gif"},
                {url: "image/avatar/gif/192.gif"},
                {url: "image/avatar/gif/193.gif"},
                {url: "image/avatar/gif/194.gif"},
                {url: "image/avatar/gif/195.gif"},
                {url: "image/avatar/gif/196.gif"},
                {url: "image/avatar/gif/197.gif"},
                {url: "image/avatar/gif/198.gif"},
                {url: "image/avatar/gif/199.gif"},
                {url: "image/avatar/gif/200.gif"},
                {url: "image/avatar/gif/201.gif"},
                {url: "image/avatar/gif/202.gif"},
                {url: "image/avatar/gif/203.gif"},
            ],
            cardTitle: "",  //标题
            cardShowValue: false,
            dataValue: "",    //要修改的值
            newUpdateValue: "",    //更改的新值
            updateCategory: "",   //类别
            oldAvatarId: "null",
            updateCardGenderImgUrl: "",  //修改性别是显示的图片

            /*picker*/
            picker_years: Array.from({length: 40}, (_, index) => new Date().getFullYear() - index),   //年份
            picker_months: Array.from({length: 12}, (_, index) => new Date().getMonth() + index-1 ),   //月份
            picker_days: null,  //天
            pointerDown: false,               //鼠标/手指是否按下
            itemHeight: 38,                   //每个picker_item高5rem=5*16=80px
            // picker_column从初始状态到达最高点的y轴移动量  正值
            yearHighPoint: 0,          // 年份最顶部 一直是0
            monthHighPoint: 0,  //初始化改变
            dayHighPoint: 0, //初始化改变
            // picker_column从初始状态到达最低点的y轴移动量  负值
            yearLowPoint: -1482,
            monthLowPoint: -418,//初始化改变
            dayLowPoint: 0,//初始化改变

            lastPoint: 0,                  //鼠标/手指按下且移动，刚才的y轴位置
            currentPoint: 0,                  //鼠标/手指保持按下且移动，此时的y轴位置
            friction: 1.5,                 //摩擦系数。鼠标拖动距离*friction=picker滚动距离

            //坐标
            year_downInitialY: 0,
            month_downInitialY: 0,
            day_downInitialY: 0,
            //距离
            year_distance: 0,  //鼠标/手指的移动距离=currentPoint-lastPoint
            month_distance: 0,  //鼠标/手指的移动距离=currentPoint-lastPoint
            day_distance: 0,  //鼠标/手指的移动距离=currentPoint-lastPoint
            //id
            picker_year_column_id: null,
            picker_month_column_id: null,
            picker_day_column_id: null,
            //class
            picker_year_item: document.getElementsByClassName("picker_year_item"),
            picker_month_item: document.getElementsByClassName("picker_month_item"),
            picker_day_item: null,
            //选中的index
            selectedYearIndex: 0,
            selectedMonthIndex: 0,
            selectedDayIndex: 0,
            //选中的日期
            selectedYear: '0',
            selectedMonth: '0',
            selectedDay: '0',

        },
        methods: {
            /*修改生日 打开修改卡时初始化*/
            initPickerItem() {
                this.picker_day_item = document.getElementsByClassName("picker_day_item")
                //日期
                this.selectedYear = new Date().getFullYear().toString()
                this.selectedMonth = '1'
                this.selectedDay = '1'
                //下标
                this.selectedYearIndex = 0
                this.selectedMonthIndex = 0
                this.selectedDayIndex = 0

                this.picker_year_item[0].style.color = 'rgb(0, 229, 123)'
                this.picker_month_item[0].style.color = 'rgb(0, 229, 123)'
                this.picker_day_item[0].style.color = 'rgb(0, 229, 123)'

            },
            /*根据选中的年月，改变每月天数*/
            setPicker_days() {
                let year = this.selectedYear
                let month = this.selectedMonth
                const days = new Date(year, month, 0).getDate() // 28
                this.dayLowPoint = -(days - 1) * this.itemHeight
                this.picker_days = Array.from({length: days}, (_, index) => 1 + index)
            },
            /*改变选中的颜色*/
            filterPickerItem(v, old_index, new_index) {
                if (v === 'year') {
                    this.picker_year_item[old_index].style.color = 'rgb(143, 143, 143)'
                    this.picker_year_item[new_index].style.color = 'rgb(0, 229, 123)'
                    // this.selectedYearIndex = new_index
                }
                if (v === 'month') {
                    this.picker_month_item[old_index].style.color = 'rgb(143, 143, 143)'
                    this.picker_month_item[new_index].style.color = 'rgb(0, 229, 123)'
                    // this.selectedMonIndex = new_index
                }
                if (v === 'day') {
                    this.picker_day_item[old_index].style.color = 'rgb(143, 143, 143)'
                    this.picker_day_item[new_index].style.color = 'rgb(0, 229, 123)'
                    // this.selectedYearIndex = new_index
                }
            },
            /*按下鼠标*/
            setPointerDownTrue(v) {
                if (v === 'year') {
                    this.picker_year_column_id = document.getElementById("picker_year_column")
                    this.picker_year_column_id.style.transition = "initial"
                    this.year_downInitialY = event.clientY;
                }
                if (v === 'month') {
                    this.picker_month_column_id = document.getElementById("picker_month_column")
                    this.picker_month_column_id.style.transition = "initial"
                    this.month_downInitialY = event.clientY;
                }
                if (v === 'day') {
                    this.picker_day_column_id = document.getElementById("picker_day_column")
                    this.picker_day_column_id.style.transition = "initial"
                    this.day_downInitialY = event.clientY;
                }
                this.pointerDown = true;
            },
            /*移动鼠标*/
            selectYearMove(v) {
                let _this = this
                if (this.pointerDown) {
                    if (v === 'year') {
                        const initialY = event.clientY
                        this.year_distance += (initialY - this.year_downInitialY) * this.friction
                        if ((this.year_distance <= this.yearHighPoint) && (this.year_distance >= this.yearLowPoint)) {
                            this.picker_year_column_id.style.transform = `translate(0px,${this.year_distance}px)`
                            this.year_downInitialY = initialY
                        } else if (this.year_distance > this.yearHighPoint) {
                            this.year_distance = this.yearHighPoint
                        } else if (this.year_distance < this.yearLowPoint) {
                            this.year_distance = this.yearLowPoint
                        }
                    }
                    if (v === 'month') {
                        const initialY = event.clientY
                        this.month_distance += (initialY - this.month_downInitialY) * this.friction
                        if ((this.month_distance <= this.monthHighPoint) && (this.month_distance >= this.monthLowPoint)) {
                            this.picker_month_column_id.style.transform = `translate(0px,${this.month_distance}px)`
                            this.month_downInitialY = initialY
                        } else if (this.month_distance > this.monthHighPoint) {
                            this.month_distance = this.monthHighPoint
                        } else if (this.month_distance < this.monthLowPoint) {
                            this.month_distance = this.monthLowPoint
                        }
                    }
                    if (v === 'day') {
                        const initialY = event.clientY
                        this.day_distance += (initialY - this.day_downInitialY) * this.friction
                        if ((this.day_distance <= this.dayHighPoint) && (this.day_distance >= this.dayLowPoint)) {
                            this.picker_day_column_id.style.transform = `translate(0px,${this.day_distance}px)`
                            this.day_downInitialY = initialY
                        } else if (this.day_distance > this.dayHighPoint) {
                            this.day_distance = this.dayHighPoint
                        } else if (this.day_distance < this.dayLowPoint) {
                            this.day_distance = this.dayLowPoint
                        }
                    }

                }
            },
            /*抬起鼠标*/
            setPointerDownFalse(v) {
                if (this.pointerDown === true) {
                    if (v === 'year') {
                        var remainder = this.year_distance % this.itemHeight;
                        //2、distance为itemHeight的整数倍，这样就可以对齐picker_selector
                        if (this.year_distance < 0 && Math.abs(remainder) < 0.5 * this.itemHeight) {
                            this.year_distance -= remainder
                        } else if (this.year_distance < 0 && Math.abs(remainder) >= 0.5 * this.itemHeight) {
                            this.year_distance = this.year_distance - remainder - this.itemHeight
                        } else if (this.year_distance >= 0 && Math.abs(remainder) < 0.5 * this.itemHeight) {
                            this.year_distance -= remainder
                        } else if (this.year_distance >= 0 && Math.abs(remainder) >= 0.5 * this.itemHeight) {
                            this.year_distance = this.year_distance - remainder + this.itemHeight
                        }
                        /*粘性*/
                        this.picker_year_column_id.style.transition = "transform 0.5s"
                        this.picker_year_column_id.style.transform = `translate(0px,${this.year_distance}px)`
                        let new_index = 0 - this.year_distance / this.itemHeight
                        this.filterPickerItem('year', this.selectedYearIndex, new_index)
                        this.selectedYearIndex = new_index
                        this.selectedYear = this.picker_year_item[new_index].innerHTML
                    }
                    if (v === 'month') {
                        var remainder = this.month_distance % this.itemHeight;
                        //2、distance为itemHeight的整数倍，这样就可以对齐picker_selector
                        if (this.month_distance < 0 && Math.abs(remainder) < 0.5 * this.itemHeight) {
                            this.month_distance -= remainder
                        } else if (this.month_distance < 0 && Math.abs(remainder) >= 0.5 * this.itemHeight) {
                            this.month_distance = this.month_distance - remainder - this.itemHeight
                        } else if (this.month_distance >= 0 && Math.abs(remainder) < 0.5 * this.itemHeight) {
                            this.month_distance -= remainder
                        } else if (this.month_distance >= 0 && Math.abs(remainder) >= 0.5 * this.itemHeight) {
                            this.month_distance = this.month_distance - remainder + this.itemHeight
                        }
                        /*粘性*/
                        this.picker_month_column_id.style.transition = "transform 0.5s"
                        this.picker_month_column_id.style.transform = `translate(0px,${this.month_distance}px)`
                        let new_index = 0 - this.month_distance / this.itemHeight
                        this.filterPickerItem('month', this.selectedMonthIndex, new_index)
                        this.selectedMonthIndex = new_index
                        this.selectedMonth = this.picker_month_item[new_index].innerHTML
                        this.setPicker_days()
                    }
                    if (v === 'day') {
                        var remainder = this.day_distance % this.itemHeight;
                        //2、distance为itemHeight的整数倍，这样就可以对齐picker_selector
                        if (this.day_distance < 0 && Math.abs(remainder) < 0.5 * this.itemHeight) {
                            this.day_distance -= remainder
                        } else if (this.day_distance < 0 && Math.abs(remainder) >= 0.5 * this.itemHeight) {
                            this.day_distance = this.day_distance - remainder - this.itemHeight
                        } else if (this.day_distance >= 0 && Math.abs(remainder) < 0.5 * this.itemHeight) {
                            this.day_distance -= remainder
                        } else if (this.day_distance >= 0 && Math.abs(remainder) >= 0.5 * this.itemHeight) {
                            this.day_distance = this.day_distance - remainder + this.itemHeight
                        }
                        /*粘性*/
                        this.picker_day_column_id.style.transition = "transform 0.5s"
                        this.picker_day_column_id.style.transform = `translate(0px,${this.day_distance}px)`
                        let new_index = 0 - this.day_distance / this.itemHeight
                        this.filterPickerItem('day', this.selectedDayIndex, new_index)
                        this.selectedDayIndex = new_index
                        this.selectedDay = this.picker_day_item[new_index].innerHTML
                    }
                }
                this.newUpdateValue = this.selectedYear + '-' + this.selectedMonth + '-' + this.selectedDay  //新日期
                this.pointerDown = false
            },

            /*选择性别按钮*/
            selectGenderBtn(v) {
                this.newUpdateValue = v
                if (v === 0)   //复制性别图片
                    this.updateCardGenderImgUrl = "image/index_04/girl_icon.png"
                if (v === 1)
                    this.updateCardGenderImgUrl = "image/index_04/boy_icon.png"
                if (v === 2)
                    this.updateCardGenderImgUrl = "image/index_04/alien_icon.png"

            },
            /*确认修改生日按钮*/
            updateBirthdayConfirmBtn() {
                let new_date = this.getTimeDate(this.newUpdateValue)
                let old_date = this.getTimeDate(this.getNowDate())
                if (new_date - old_date > 0) {
                    NotificationVue.showPublicNotification("warn", "此时你还没有出生，换一个日期吧。")
                } else if (this.newUpdateValue !== this.dataValue) {
                    let _this = this;
                    axios({
                        method: "post",
                        url: "update/updateUserData?newValue=" + this.newUpdateValue + "&category=" + this.updateCategory
                    }).then(async function (data) {
                        if (data.data) {
                            await userDataApp.fetchUserInformationAxios()  //如修改成功  这刷新user数据
                            _this.closeUpdateCard()   //关闭选卡片
                            NotificationVue.showPublicNotification("success", "修改成功！")
                        } else {
                            NotificationVue.showPublicNotification("error", "发生未知错误，修改失败！")
                        }
                    });
                }
            },
            updateConfirmBtn() {
                let _this = this
                if ((this.newUpdateValue.length !== 0) && (this.newUpdateValue !== this.dataValue)) {
                    axios({
                        method: "post",
                        url: "update/updateUserData?newValue=" + this.newUpdateValue + "&category=" + this.updateCategory
                    }).then(async function (data) {
                        if (data.data) {
                            await userDataApp.fetchUserInformationAxios()  //如修改成功  这刷新user数据
                            _this.closeUpdateCard()   //关闭选卡片
                            NotificationVue.showPublicNotification("success", "修改成功！")
                        } else {
                            NotificationVue.showPublicNotification("error", "发生未知错误，修改失败！")
                        }
                    });
                }
            },
            openUpdateCard(category, value) {
                this.updateCategory = category
                this.dataValue = value  //要修改的值
                this.cardShowValue = true
                if (category === 'avatar')
                    this.cardTitle = "修改头像"
                if (category === 'synopsis') {
                    this.newUpdateValue = this.dataValue
                    this.cardTitle = "修改简介"
                }
                if (category === 'nickname') {
                    this.newUpdateValue = this.dataValue
                    this.cardTitle = "修改昵称"
                }
                if (category === 'gender') {
                    this.newUpdateValue = this.dataValue
                    this.cardTitle = "修改性别"
                    if (this.newUpdateValue === 0)   //复制性别图片
                        this.updateCardGenderImgUrl = "image/index_04/girl_icon.png"
                    if (this.newUpdateValue === 1)
                        this.updateCardGenderImgUrl = "image/index_04/boy_icon.png"
                    if (this.newUpdateValue === 2)
                        this.updateCardGenderImgUrl = "image/index_04/alien_icon.png"
                }
                if (category === 'birthday') {
                    this.cardTitle = "修改生日"
                    this.newUpdateValue = this.dataValue
                    /*初始化*/
                    this.setPicker_days()
                    setTimeout(() => {
                        this.initPickerItem()
                    }, 10);
                }

                if (category === 'phonenumber') {
                    this.newUpdateValue = this.dataValue
                    this.cardTitle = "修改手机号"
                }
                if (category === 'region') {
                    this.newUpdateValue = this.dataValue
                    this.cardTitle = "修改地区"
                }
                if (category === 'school') {
                    this.newUpdateValue = this.dataValue
                    this.cardTitle = "修改学校"
                }


            },
            closeUpdateCard() {
                this.cardShowValue = false
                this.dataValue = ""    //要修改的值
                this.newUpdateValue = ""    //更改的新值
                this.updateCategory = ""   //类别
                this.oldAvatarId = "null"
            },
            avatarImgBtn(v) {
                const new_id = document.getElementById(v)
                if (v === this.oldAvatarId) {  //点击同一个
                    new_id.classList.remove("avatar_border_active")
                    this.oldAvatarId = "null"
                    this.newUpdateValue = ""
                } else {
                    if (this.oldAvatarId === "null") {   //第一次点击
                        this.oldAvatarId = v
                        new_id.classList.add("avatar_border_active")
                    } else {
                        const old_id = document.getElementById(this.oldAvatarId)
                        old_id.classList.remove("avatar_border_active")
                        new_id.classList.add("avatar_border_active")
                        this.oldAvatarId = v
                    }
                    this.newUpdateValue = v
                }

            },
            /*时间转换*/
            getTimeDate(date) {
                return new Date(date).getTime();
            },
            //获取日期
            getNowDate() {
                let date = new Date()
                return (date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate()).toString()
            },
        }
    })
    /*弹窗*/
    const MessageBoxVue = new Vue({
        el: "#MessageBoxContent",
        data: {
            messageBoxQuestion: "",
            borderFramesValue: false
        },
        methods: {
            /*public确认还是取消按钮并关闭弹窗*/
            messageBoxConfirmBtn(v) {
                // console.log("v="+v)
                window.sessionStorage.setItem("messageBoxConfirmValue", v);
                //关闭弹窗
                let messageBox = document.getElementById("messageBox");
                let MessageBoxContent = document.getElementById("MessageBoxContent");
                MessageBoxContent.style.display = "none"
                messageBox.style.marginTop = "-200px";
                // console.log(window.sessionStorage.getItem("messageBoxConfirmValue")==="true")
            },
            /*打开弹窗 其他vue实例使用*/
            openMessageBox(content) {
                sessionStorage.setItem("messageBoxConfirmValue", "null");
                this.messageBoxQuestion = content
                // this.functionName = functionName
                let messageBox = document.getElementById("messageBox");
                let MessageBoxContent = document.getElementById("MessageBoxContent");
                MessageBoxContent.style.display = "flex"
                messageBox.style.marginTop = "20px";
            },
            tipEffection() {
                console.log("123")
                this.borderFramesValue = true
            },
            tipEffectionEnd() {
                this.borderFramesValue = false
            },
        }
    })
    /*消息vue*/
    const NotificationVue = new Vue({
        el: "#notification",
        data: {
            no_content: '',
            no_type: '',   //error，message消息，warn警告,success成功
            timer: null,
            spantype: {
                error: {
                    value: '失败',
                    src: 'image/public_notification/error.png'
                },
                message: {
                    value: '消息',
                    src: 'image/public_notification/message.png'
                },
                success: {
                    value: '成功',
                    src: 'image/public_notification/success.png'
                },
                warn: {
                    value: '警告',
                    src: 'image/public_notification/warn.png'
                },
            }
        },
        methods: {
            showPublicNotification(type, content) {
                if (this.timer) { //计时器已经存在则销毁
                    clearTimeout(this.timer)
                    this.timer = null
                }
                const id = document.getElementById("notification")
                id.style.right = "30px";
                this.no_content = content
                this.no_type = type
                this.timer = setTimeout(() => {
                    this.no_content = ''
                    this.no_type = ''
                    id.style.right = "-300px"
                }, 3000)
            }
        },
    })
</script>
</body>
</html>
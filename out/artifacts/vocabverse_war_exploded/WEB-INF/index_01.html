<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Werse词境 学习</title>
    <script src="js/echarts.min.js"></script>
    <script src="js/jquery-3.7.0.min.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/axios-0.18.0.js"></script>
    <link rel="icon" href="image/logo-white.png">
    <link rel="stylesheet" href="css/public/main.css">
    <link rel="stylesheet" href="css/top-nav.css">
    <link rel="stylesheet" href="css/index_01.css">
    <style>
        /*弹出框动效*/
        .MessageBoxBorderFrames {
            animation: MessageBoxBorderFrames 0.3s linear;
        }

        .left_sort_span_focus {
            background-color: var(--greenColor00e57b);
            color: #1a1a1a;
        }

        .switch_btn {
            cursor: pointer;
            padding: 4px;
            font-size: 0.9em;
            font-weight: 800;
            border: 2px solid #00e57b;
            border-radius: 5px;
            width: 50%;
            height: 100%;
        }

        .switch_btn_active {
            background-color: #00e57b;
            color: black;
        }

        .tip_example_control_span {
            box-sizing: border-box;
            border: 2px solid #00e57b;
            cursor: pointer;
            margin-left: 5px;
            border-radius: 4px;
            padding: 4px;
            width: auto;
            font-size: 0.9em;
            font-weight: 800;
            background-color: #1a1a1a;
            color: #ffffff;
            transition: all 0.2s;
        }

        .tip_example_control_span_not_allow {
            cursor: not-allowed;
            margin-left: 5px;
            border-radius: 4px;
            padding: 4px;
            width: auto;
            font-size: 0.9em;
            font-weight: 800;
            background-color: #676767;
            color: #c4c4c4;
            transition: all 0.2s;
        }

        .tip_example_control_span:hover {
            background-color: #00e57b;
            color: #000000;
        }


        .tip_example_control_span_focus {
            cursor: pointer;
            background-color: #00e57b;
            color: #000000;
        }
    </style>
</head>
<body>
<!-- 顶部导航栏，三个元素 -->
<div class="top-nav">
    <div class="index-logo">
        <a href="homePage" class="index_logo_a">
            <img class="logo_img" src="image/topnav/topnavlogo.png" alt="Werse">
            <h2 class="logo_h2_e">e</h2>
            <h2 class="logo_h2_r">r</h2>
            <h2 class="logo_h2_s">s</h2>
            <h2 class="logo_h2_e1">e</h2>
        </a>
    </div>
    <div class="nav-content">
        <a href="homePage"><span>首页</span></a>
        <a href="studyPage"
           style="color: #00e57b;box-sizing: border-box;border-top: 3px #00e57b solid;"><span>学习</span></a>
        <a><span>查</span><span>-</span><span>译</span></a>
        <div class="cha_yi_div">
            <a href="searchWordPage">查词</a>
            <a href="translatePage">翻译</a>
        </div>
        <a href="wersebotPage"><span>WerseBot</span></a>
        <a href="dataPage"><span>数据</span></a>
    </div>
    <div class="more-nav">
<!--        <div class="message_nav">-->
<!--            <img src="image/topnav/messagelogo_white.png" alt="">-->
<!--            <h3>消息</h3>-->
<!--        </div>-->
    </div>
</div>
<!--通知-->
<div id="notification" class="public_notification_div">
    <div class="public_notification_title">
        <div v-if="no_type==='error'" class="notification_item_tittle">
            <img :src="spantype.error.src">
            <span>{{spantype.error.value}}</span>
        </div>
        <div v-if="no_type==='message'" class="notification_item_tittle">
            <img :src="spantype.message.src">
            <span>{{spantype.message.value}}</span>
        </div>
        <div v-if="no_type==='warn'" class="notification_item_tittle">
            <img :src="spantype.warn.src">
            <span>{{spantype.warn.value}}</span>
        </div>
        <div v-if="no_type==='success'" class="notification_item_tittle">
            <img :src="spantype.success.src">
            <span>{{spantype.success.value}}</span>
        </div>
    </div>
    <div class="public_notification_content">{{no_content}}</div>
</div>
<!--弹窗-->
<div @touchmove.prevent="false" id="MessageBoxContent" class="MessageBoxDiv" @click="tipEffection">
    <div id="messageBox" class="MessageBox" :class="{'MessageBoxBorderFrames':borderFramesValue}"
         @animationend="tipEffectionEnd">
        <div class="MessageBoxContent">{{messageBoxQuestion}}</div>
        <div class="MessageBoxController">
            <span @click.stop="messageBoxConfirmBtn(true)">确认</span>
            <span @click.stop="messageBoxConfirmBtn(false)">取消</span>
        </div>
    </div>
</div>
<!--内容-->
<div style="width: 100%" id="studyApp">
    <div v-if="control_userbook_div_state" class="control_example_div">
        <div class="control_example_content_div">
            <!--标题-->
            <div class="tittle_sort_div">
                <div class="tittle_div">
                    <span v-show="all_add_detail_userbook==0" class="tittle_span">我的词库</span>
                    <span v-show="all_add_detail_userbook==1" class="tittle_span">新建词库</span>
                    <span v-show="all_add_detail_userbook==2"
                          class="tittle_span">{{theUserBookDetail.userbookname}}</span>
                    <span @click="controlUserBookBtn" class="close_div_btn"></span>
                </div>
                <div class="sort_div">
                    <!--显示例句时渲染-->
                    <span class="backOradd" @click="addUserbookBtn"
                          v-show="all_add_detail_userbook==0">新建词库</span>
                    <span class="backOradd" @click="userBookBackBtn" v-show="all_add_detail_userbook!==0">返回</span>
                    <span class="backOradd" @click="addUserBookConfirmBtn"
                          v-show="all_add_detail_userbook==1">确认添加</span>
                </div>
            </div>
            <!--我的所有词库-->
            <div v-if="all_add_detail_userbook==0" class="all_example_list">
                <div v-if="alMyUserBooks.length==0"
                     style="width: 100%;height: 100%;display:flex;justify-content: center;">
                    <span style="margin: auto;color: whitesmoke;font-weight: 700">这里空空如也。你还没有任何词库！</span>
                </div>
                <div v-else v-for="(item,index) in alMyUserBooks" class="userBookItemDiv"
                     @click="theUserBookDetailBtn(item.userbookid)">
                    <div class="userBookNameDiv">
                        <span class="userBookNameDiv_child1"></span>
                        <span class="userBookNameDiv_child2">{{item.userbookname}}</span>
                    </div>
                    <span class="addTheWordToCikuBtn"
                          @click.stop="addWordToUserBookBtn(item.userbookid)">加入该词库</span>
                </div>
            </div>
            <!--添加云词库-->
            <div v-if="all_add_detail_userbook==1" class="all_example_list">
                <div class="addUserBookDiv">
                    <label>词库名称&nbsp;</label> <input v-model="userbookname" maxlength="20" type="text"
                                                         placeholder="词库名称(必须向)">
                </div>
                <div class="addUserBookDiv_jianjie">
                    <label>词库简介&nbsp;</label>
                    <textarea v-model="bookdescribe" placeholder="词库简介(非必须向)" maxlength="50"></textarea>
                </div>
                <div class="double_switch_div">
                    <label>词库属性&nbsp;</label>
                    <div class="double_switch_div_btn">
                        <span class="switch_btn switch_btn_active" id="switchBtnStatus_0"
                              @click="switchBtn(0)">私密</span>
                        <span class="switch_btn" id="switchBtnStatus_1" @click="switchBtn(1)">公开</span>
                    </div>
                </div>
            </div>
            <!--词库详情-->
            <div v-if="all_add_detail_userbook==2" class="the_book_all_words_div">
                <div v-show="all_add_detail_userbook==2" class="userbook_detail_tittle_div">
                    <div>简介:{{theUserBookDetail.bookdescribe}}</div>
                    <div>属性:{{theUserBookDetail.share == 0 ? "私密词库" : "公开词库" }}</div>
                </div>
                <div class="all_words_div">
                    <div @click="theWordDetail(item.wordid)" v-for="(item,index) in theUserBookOfAllWords">
                        <span class="all_words_div_item_span">{{item.word.spelling}}</span>
                        <span @click.stop="deleteTheWordFormUserBookBtn(item.wordid,item.bookid)" class="word_item_span"
                              style="width: 20px;height: 20px">&nbsp;</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div v-if="control_setexample_div_state" class="control_example_div">
        <div class="control_example_content_div">
            <!--标题-->
            <div class="tittle_sort_div">
                <div class="tittle_div">
                    <span class="tittle_span">为{{studyWord.word.spelling}}选择提示例句</span>
                    <span @click="setTipExmaple" class="close_div_btn"></span>
                </div>
                <div class="sort_div">
                    <span id="tip_example_control_state_2" @click="tipExampleControlStateBtn(2)"
                          class="tip_example_control_span tip_example_control_span_focus">全部</span>
                    <span id="tip_example_control_state_1" @click="tipExampleControlStateBtn(1)"
                          class="tip_example_control_span">我选择的</span>
                </div>
            </div>
            <!--显示页面-->
            <div class="all_example_list">
                <div v-if="cardExampleList.length===0"
                     style="width: 100%;height: 100%;display:flex;justify-content: center;">
                    <span style="margin: auto;color: whitesmoke;font-weight: 700">这里空空如也。这个单词还没有例句！</span>
                </div>
                <div v-show="tipExampleControlState==2" v-for="(item,index) in cardExampleList" class="all_example_item"
                     style="display:flex;justify-content: space-between;align-items: center">
                    <div class="all_example_item_select_control_div">
                        <span v-show="item.exapid!==studyWord.exapid" class="all_example_item_select_control_no"
                              @click="updateTipExampleBtn(item.exapid,item.en,item.cn)"></span>
                        <span v-show="item.exapid===studyWord.exapid"
                              class="all_example_item_select_control_yes"></span>
                    </div>
                    <div style="width: 450px">
                        <div class="example_text">{{item.en}}</div>
                        <div class="example_text">{{item.cn}}</div>
                        <div class="example_info">
                        <span @click="heatBtn(item.exapid)" class="example_heat"><img
                                src="image/pageWordDetail/heat_span.png">{{item.heat}}</span>
                            <span class="example_holder">由{{item.holder == null ? "*已注销用户*" : item.holder}}在<span
                                    class="example_adddate">{{item.adddate}}</span>添加</span>
                        </div>
                    </div>
                </div>
                <div v-show="tipExampleControlState===1&&item.exapid===studyWord.exapid"
                     v-for="(item,index) in cardExampleList" class="all_example_item"
                     style="display:flex;justify-content: space-between;align-items: center">
                    <div class="all_example_item_select_control_div">
                        <span class="all_example_item_select_control_yes"></span>
                    </div>
                    <div style="width: 450px">
                        <div class="example_text">{{item.en}}</div>
                        <div class="example_text">{{item.cn}}</div>
                        <div class="example_info">
                        <span @click="heatBtn(item.exapid)" class="example_heat"><img
                                src="image/pageWordDetail/heat_span.png">{{item.heat}}</span>
                            <span class="example_holder">由{{item.holder == null ? "*已注销用户*" : item.holder}}在<span
                                    class="example_adddate">{{item.adddate}}</span>添加</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div v-if="control_selectword_div_state" class="control_example_div">
        <div class="control_example_content_div">
            <!--标题-->
            <div class="tittle_sort_div">
                <div class="tittle_div">
                    <span class="tittle_span">选词</span>
                    <span @click="selectWordCardBtn" class="close_div_btn"></span>
                </div>
                <div v-show="!showTheBookOfWords" class="sort_div">
                    <span id="select_word_control_state_1" @click="selectWordControlStateBtn(1)"
                          class="tip_example_control_span tip_example_control_span_focus">官方词库</span>
                    <span id="select_word_control_state_2" @click="selectWordControlStateBtn(2)"
                          class="tip_example_control_span">共享词库</span>
                </div>
                <div v-show="showTheBookOfWords" class="sort_div" style="display: flex;justify-content: space-between">
                    <span>
                        <span class="tip_example_control_span" @click="selectWordControlBackBtn">返回</span>
                        <span @click="selectWordConfirmBtn" id="select_word_confirm_btn_id" class="tip_example_control_span_not_allow">确定</span>
                        <span style="color: whitesmoke">已选{{selectedWordList.length}}个</span>
                    </span>
                    <span style="padding-right: 5px">
                        <span class="tip_example_control_span tip_example_control_span_focus"
                              @click="showWordItemParaphraseBtn">{{showWordItemParaphrase ? '隐藏释义' : '显示释义'}}</span>
                        <span class="tip_example_control_span tip_example_control_span_focus"
                              @click="showSelectedWordStateBtn">{{showSelectedWordState ? '隐藏已选' : '显示已选'}}</span>
                    </span>
                </div>
            </div>
            <!--显示词库页面-->
            <div v-show="!showTheBookOfWords" class="all_example_list">
                <div v-show="selectWordControlState===1" v-for="(item,index) in officialBooks"
                     @click="theBookAllWords(item.bookid)" class="all_example_item all_select_books_item">
                    <span>{{item.bookname}}</span>
                    <span>{{item.voccount}}&nbsp;词</span>
                </div>
                <div v-show="selectWordControlState===2" v-for="(item,index) in userBooks"
                     @click="theBookAllWords(item.userbookid)" class="all_example_item all_select_books_item">
                    <span>{{item.userbookname}}</span>
                    <span>{{item.voccount}}&nbsp;词</span>
                </div>
            </div>
            <div v-show="showTheBookOfWords" class="all_example_list">
                <div class="all_word_item" v-for="(item,index) in bookOfAllWords"
                     v-show="showSelectedWordState? true:!myAllStudyWords.find(wordItem => wordItem.wordid === item.wordid)">
                    <div class="all_word_item_icon_spelling">
                        <span v-if="myAllStudyWords.find(wordItem => wordItem.wordid === item.wordid)"
                              style="background-image: url('image/public_icon/selected_icon_gray.png');cursor: not-allowed"></span>
                        <span @click="selectTheWordBtn(item.wordid,index)"
                              v-else-if="!selectedWordList.includes(item.wordid)"
                              style="background-image: url('image/public_icon/no_selecte_cion_green.png');cursor: pointer"></span>
                        <span @click="selectTheWordBtn(item.wordid,index)" v-else
                              style="background-image: url('image/public_icon/selected_icon_green.png');cursor: pointer"></span>
                        <span>{{item.word.spelling}}</span>
                    </div>
                    <div class="all_word_item_detail_btn">
                        <span v-show="showWordItemParaphrase">{{item.word.paraphrase}}</span>
                        <span @click="theWordDetail(item.word.wordid)"></span>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="content-body">
        <div class="content-div">
            <!--复习-->
            <div v-if="studyingOrNot">
                <div class="study_rate_div">
                    <span :style="{'width':tittleGreenWidth+'%'}">{{daily.studyword}}</span>
                    <span :style="{'width':100-tittleGreenWidth+'%'}">{{daily.shouldstudy - daily.studyword}}</span>
                </div>
                <div class="study_control_div">
                    <div class="study_today_progress_div">
                        <span>{{daily.studyword}}/{{daily.shouldstudy}}</span>
                        <span>复习次数:{{daily.studytime}}</span>
                    </div>
                    <div class="study_today_control_div">
                        <span @click="alreadyKnownBtn"></span>
                        <span @click="deleteStudyWordPlanningBtn()"></span>
                        <span @click="controlUserBookBtn"></span>
                    </div>
                </div>
                <!--复习与释义-->
                <div v-if="thinkingOrNot" @mousedown.left.self="nextWordBtn" @mousemove="nextWordCancelBtn"
                     @mouseup.left.self="nextWordCancelBtn" class="study_content_div">
                    <div class="study_word_inform">
                        <div class="study_word_audio_div">
                            <h1>{{studyWord.word.spelling}}</h1>
                            <div class="study_audio_div">
                                <div class="study_audio_UK_USA_div" style="padding-right: 10px" id="UK_audio_btn"
                                     @click.stop="playAudio($event)">英[{{studyWord.word.ukphonetic}}]<span
                                        class="study_audio_icon"></span>
                                </div>
                                <audio id="UK_audio" preload="metadata" :src="audio_type1"></audio>
                                <div class="study_audio_UK_USA_div" id="USA_audio_btn" @click.stop="playAudio($event)">
                                    美[{{studyWord.word.usphonetic}}]<span class="study_audio_icon"></span></div>
                                <audio id="USA_audio" preload="metadata" :src="audio_type2"></audio>
                            </div>
                        </div>
                        <div class="study_example_div">
                            <span v-html="highLightWord(studyWord.example.en)">{{studyWord.example.en}}</span>
                            <span class="example_audio_btn" @click.stop="playExampleAudio()"></span>
                            <audio @ended="exampleEnded" id="example_audio" preload="metadata"
                                   :src="audio_example"></audio>
                        </div>
                    </div>
                    <div class="study_bottom_div">
                        <div style="min-width: 80px">
                                     <span style="background-color: #ff0000;padding: 2px;border-radius: 3px;font-weight: 700;"
                                           v-if="Math.abs(this.studyWord.intervalday)!==0">逾期{{Math.abs(this.studyWord.intervalday)}}天</span>

                        </div>
                        <div class="study_tip_div">
                        <span class="tip_text_span"><span class="tip_icon"></span>：稍想片刻后，长按<span
                                class="shubiao_left_icon"></span> (鼠标左键)上方空白处查看释义。</span>
                        </div>
                        <div class="next_word_div">
                            查看释义
                            <div class="nextWordFrames"></div>
                        </div>
                    </div>
                </div>
                <div v-else class="study_paraphrase_content">
                    <div class="study_paraphrase_content_left">
                        <div class="study_paraphrase_content_left_spelling">
                            <h1>{{studyWord.word.spelling}}</h1>
                            <div class="spelling_detail_div">、
                                <span class="spelling_detail_icon" @click="theWordDetail(studyWord.word.wordid)"></span>
                                <span class="spelling_detail_text">查看单词详情</span>
                            </div>
                        </div>
                        <div class="study_audio_div">
                            <div class="study_audio_UK_USA_div" style="padding-right: 10px" id="UK_audio_btn_paraphrase"
                                 @click.stop="playAudio($event)">英[{{studyWord.word.ukphonetic}}]<span
                                    class="study_audio_icon"></span>
                            </div>
                            <audio id="UK_audio_paraphrase" preload="metadata" :src="audio_type1"></audio>
                            <div class="study_audio_UK_USA_div" id="USA_audio_btn_paraphrase"
                                 @click.stop="playAudio($event)">
                                美[{{studyWord.word.usphonetic}}]<span class="study_audio_icon"></span></div>
                            <audio id="USA_audio_paraphrase" preload="metadata" :src="audio_type2"></audio>
                        </div>
                        <div class="wordParaphraseDiv">
                            <h3 style="color: var(--greenColor00e57b)">释义</h3>
                            <div style="user-select: text;">{{studyWord.word.paraphrase}}</div>
                        </div>
                        <div style="padding-top: 30px">
                            <div class="study_example_title_div">
                                <h3>提示例句</h3>
                                <span @click="setTipExmaple"></span>
                            </div>
                            <div class="study_example_paraphrase_div">
                                <div style="align-items: center">
                                <span style="font-size: 1.1em"
                                      v-html="highLightWord(this.studyWord.example.en)">{{studyWord.example.en}}</span>
                                    <span class="example_audio_btn example_audio_paraphrase_btn"
                                          @click.stop="playExampleAudioParaphrase()"></span>
                                    <audio @ended="exampleEnded" id="example_audio_paraphrase" preload="metadata"
                                           :src="audio_example"></audio>
                                </div>
                                <div style="font-size: 1em">{{studyWord.example.cn}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="study_paraphrase_content_right">
                        <div class="study_information">
                            <div class="today_information_div">
                                <div class="today_information_item">
                                    <div>{{studyWord.day_studycount}}次</div>
                                    <div><span class="today_information_item_day_studycount"></span>今天复习</div>
                                </div>
                                <div class="today_information_item">
                                    <div v-html="timeCount(oneWordThinkTime)">{{oneWordThinkTime}}</div>
                                    <div><span class="today_information_item_day_oneWordThinkTime"></span>思考时间</div>
                                </div>
                            </div>
                            <div id="stackChart" style="width: 100%;height: 150px;padding-top: 20px">

                            </div>
                        </div>
                        <div class="feedBack_control_div">
                            <div v-show="qualityState!==-1" style="padding-bottom: 10px">
                                <div v-show="qualityState===3" class="feedBack_control_introduce_div">
                                    <img src="image/public_icon/emoji/green.png">
                                    <div class="feedBack_control_introduce_text_div">
                                        看到单词立马能想起意思(选择后今天不再复习)
                                    </div>
                                </div>
                                <div v-show="qualityState===2" class="feedBack_control_introduce_div">
                                    <img src="image/public_icon/emoji/blue.png">
                                    <div class="feedBack_control_introduce_text_div">
                                        片刻思考后能想起意思
                                    </div>
                                </div>
                                <div v-show="qualityState===1" class="feedBack_control_introduce_div">
                                    <img src="image/public_icon/emoji/orange.png">
                                    <div class="feedBack_control_introduce_text_div">
                                        对单词有模糊印象，但不确定具体含义
                                    </div>
                                </div>
                                <div v-show="qualityState===0" class="feedBack_control_introduce_div">
                                    <img src="image/public_icon/emoji/red.png">
                                    <div class="feedBack_control_introduce_text_div">
                                        不知道这个单词，没有任何印象
                                    </div>
                                </div>
                            </div>

                            <div class="feedBack_control_btn_div">
                                <span id="quality_3" @mousedown="qualityBtn(3)" @dblclick="nextWord(3)">了如指掌</span>
                                <span id="quality_2" @mousedown="qualityBtn(2)" @dblclick="nextWord(2)">恍然大悟</span>
                                <span id="quality_1" @mousedown="qualityBtn(1)" @dblclick="nextWord(1)">模模糊糊</span>
                                <span id="quality_0" @mousedown="qualityBtn(0)" @dblclick="nextWord(0)">茫无所知</span>
                            </div>
                            <div class="feedBack_control_tip">
                                <span></span>&nbsp;
                                单击选中选项，双击学习下一个单词。
                            </div>


                        </div>

                    </div>
                </div>

            </div>
            <!--完成页面-->
            <div v-else style="display: flex">
                <div class="studying_not_left_div">
                    <div class="studying_not_left_title_div">
                        <div>今日学习单词</div>
                        <div class="studying_not_left_control_div">
                            <span id="left_sort_1" @click="leftSortBtn(1)">全部</span>
                            <span id="left_sort_2" @click="leftSortBtn(2)">模糊</span>
                            <span id="left_sort_3" @click="leftSortBtn(3)">顽固</span>
                        </div>
                    </div>
                    <div class="studying_not_left_item_div">
                        <div v-show="studiedWordSortState===1" v-for="(item,index) in todayStudiedWords"
                             class="todayStudiedWords_item"
                             @click="theWordDetail(item.word.wordid)">
                            <span>{{item.word.spelling}}</span>
                            <span>详情</span>
                        </div>
                        <div v-show="studiedWordSortState===2&&item.day_q_1!==0"
                             v-for="(item,index) in todayStudiedWords"
                             class="todayStudiedWords_item"
                             @click="theWordDetail(item.word.wordid)">
                            <span>{{item.word.spelling}}</span>
                            <span>详情</span>
                        </div>
                        <div v-show="studiedWordSortState===3&&item.day_q_0!==0"
                             v-for="(item,index) in todayStudiedWords"
                             class="todayStudiedWords_item"
                             @click="theWordDetail(item.word.wordid)">
                            <span>{{item.word.spelling}}</span>
                            <span>详情</span>
                        </div>
                    </div>
                </div>

                <div class="studying_not_right_div">
                    <div>
                        <div style="display: flex;padding: 0;margin: 0;align-items: center">
                            <span class="studying_not_right_today_date">{{getNowDateFilter()}}</span>
                            <span v-if="daily.checkin===1" class="studying_not_right_today_checkin checkin_yes"></span>
                            <span v-else class="studying_not_right_today_checkin checkin_no"></span>
                        </div>
                        <div class="studying_not_right_today_information_div">
                            <div v-if="!studyingOrNot" class="today_information_item">
                                <div>{{daily.studyword}}个</div>
                                <div><span class="today_information_item_day_studywordcount"></span>学习单词</div>
                            </div>
                            <div class="today_information_item">
                                <div>{{daily.studytime}}次</div>
                                <div><span class="today_information_item_day_studycount"></span>复习次数</div>
                            </div>
                            <div class="today_information_item">
                                <div v-html="timeCount(daily.studyduration)">{{daily.studyduration}}</div>
                                <div><span class="today_information_item_day_oneWordThinkTime"></span>学习时间</div>
                            </div>
                        </div>
                        <div id="stackStudiedChart" style="width: auto;height: 150px;padding-top: 20px"></div>
                    </div>
                    <div class="studying_not_right_today_button">
                        <span v-if="daily.checkin===1" class="checkin_btn_yes">今日已签到</span>
                        <span v-else class="checkin_btn_no" @click="checkinBtn">今日未签到</span>
                    </div>
                    <div class="studying_not_right_today_other_button_div">
                        <div class="other_button_div_tip"><span></span>：今天的单词已学习完，你可以选择更多新单词继续学习。
                        </div>
                        <div class="other_button_div">
                            <div @click="selectWordCardBtn" class="other_button_word"><span
                                    class="other_button_word_span"></span>选词
                            </div>
                            <div class="other_button_team"><span class="other_button_team_span"></span>小队</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const studyApp = new Vue({
        el: '#studyApp',
        data: {
            userid: ' ',
            studyingOrNot: false,   //是否还有单词未学习，显示记单词还是已经打卡页面
            thinkingOrNot: false,  //思考 释义
            qualityState: -1,  //选择
            daily: [],
            audio_type1: '',  //英英
            audio_type2: '',   //美英
            audio_example: '',  //例句音源
            tittleGreenWidth: 0,
            lastStudyWord: [],  //复习的上一个单词
            studyWord: {},
            todayStudiedWords: [],  //今天学习的单词
            downTime: 0,
            downState: false,  //false为抬起状态 true为按下
            totalStudyTime: 0,  //总学习时间
            totalStudyTimer: null,  //总学习时间计时器
            oneWordThinkTime: 0, //单个思考时间
            oneWordThinkTimer: null,  //单个思考时间计时器
            studiedWordSortState: 1,   //排序属性
            /*自定义书籍*/
            control_userbook_div_state: false,
            all_add_detail_userbook: 0,  //0为所有书籍，1为添加书籍，2为书籍详情
            userbookname: '',  //书名
            bookdescribe: '',  //简介
            theUserBookDetail: [],      //书籍详情
            theUserBookOfAllWords: [],   //书籍的所有单词
            alreadyUserBookUpdate: false,  //是否更改过自定义词典
            alMyUserBooks: [],
            public_privacy_status: 0,  //书籍属性
            /*提示例句设置*/
            control_setexample_div_state: false,
            cardExampleList: [],
            tipExampleControlState: 2,//例句是显示全部还是我选择的  默认全部
            /*选词设置*/
            control_selectword_div_state: false,
            selectWordControlState: 1,  //1 官方词库  2 共享词库
            showTheBookOfWords: false,   //显示词库所有单词
            officialBooks: {},   //官方词库
            userBooks: {},  //共享词库
            bookOfAllWords: [],
            showSelectedWordState: false,  //显示已选单词
            showWordItemParaphrase: false,
            myAllStudyWords: [],
            selectedWordList: [],  //选择的单词


        },
        watch: {
            qualityState(newValue, oldValue) {
                const id_new = document.getElementById("quality_" + newValue)
                if (oldValue === -1) {
                    this.qualityState = newValue
                    id_new.style.borderColor = '#ffffff'
                } else {
                    this.qualityState = newValue
                    const id_old = document.getElementById("quality_" + oldValue)
                    id_new.style.borderColor = '#ffffff'
                    id_old.style.borderColor = '#1a1a1a'
                }
            },
            thinkingOrNot(newValue, oldValue) {
                let _this = this
                //画图
                if (!newValue && oldValue) {
                    setTimeout(() => {
                        _this.stackChart()
                    }, 50)
                }
                //单个学习时间
                if (newValue) {
                    _this.oneWordThinkTimer = setInterval(() => {   //定时器
                        _this.oneWordThinkTime++
                    }, 100);
                } else {
                    clearInterval(_this.oneWordThinkTimer)
                }
            },
            selectedWordList(newValue, oldValue) {
                const id = document.getElementById("select_word_confirm_btn_id")
                if (newValue.length === 0 && id.classList.contains("tip_example_control_span_focus")) {
                    id.classList.remove("tip_example_control_span_focus")
                }
                if (newValue.length !== 0 && !(id.classList.contains("tip_example_control_span_focus"))) {
                    id.classList.add("tip_example_control_span_focus")
                }


            }
        },
        created() {
            this.fetchStudyWord()
            this.fetchUserId();
        },
        methods: {
            //选择单词确定
            selectWordConfirmBtn() {
                let _this = this
                if (this.selectedWordList.length !== 0) {
                    axios({
                        url:'update/addStudyWordList?studyWordList='+_this.selectedWordList,
                        method:'post'
                    }).then(function (data){
                        if (data.data){
                            NotificationVue.showPublicNotification("success","添加成功，刷新页面即可记忆新单词。")
                            _this.fetchMyAllStudyWords()
                            _this.selectedWordList = []

                        }else{
                            NotificationVue.showPublicNotification("success","添加失败，发生未知错误。")
                        }
                    })
                }
            },
            //选择单词
            selectTheWordBtn(wordid, index) {
                if (this.selectedWordList.includes(wordid)) {
                    const _index = this.selectedWordList.indexOf(wordid);
                    this.selectedWordList.splice(_index, 1);
                } else {
                    this.selectedWordList.push(wordid)
                }
            },
            //隐藏已勾选单词
            selectWordControlBackBtn() {
                this.selectedWordList = []  //清空选择的单词
                this.showTheBookOfWords = false  //显示词库
                this.showSelectedWordState = false  //隐藏已选
            },
            showWordItemParaphraseBtn() {
                if (this.showWordItemParaphrase) {
                    this.showWordItemParaphrase = false  //隐藏已选
                } else {
                    this.showWordItemParaphrase = true
                }
            },
            showSelectedWordStateBtn() {
                if (this.showSelectedWordState) {
                    this.showSelectedWordState = false  //隐藏已选
                } else {
                    this.showSelectedWordState = true
                }
            },
            async theBookAllWords(id) {
                let _this = this
                await this.fetchMyAllStudyWords()   //获取所有studyWords
                if (this.selectWordControlState === 1) {   //官方词库
                    await axios({
                        url: 'search/getOfficialBookOfAllWords?bookid=' + id,
                        method: 'get'
                    }).then(function (data) {
                        _this.bookOfAllWords = data.data
                    })
                    this.showTheBookOfWords = true
                } else {
                    await axios({
                        url: 'search/getUserBookOfAllWords?bookid=' + id,
                        method: 'get'
                    }).then(function (data) {
                        _this.bookOfAllWords = data.data
                    })
                    this.showTheBookOfWords = true
                }
            },
            //获取所有学习计划单词
            fetchMyAllStudyWords() {
                let _this = this
                axios({
                    url: 'search/getMyAllStudyWords',
                    method: 'get'
                }).then(function (data) {
                    _this.myAllStudyWords = data.data
                })
            },
            //获取词库
            fetchBooks() {
                let _this = this
                axios({
                    url: 'search/getAllShareUserBook',
                    method: 'get'
                }).then(function (data) {
                    _this.userBooks = data.data
                })
                axios({
                    url: 'search/getAllOfficialBook',
                    method: 'get'
                }).then(function (data) {
                    _this.officialBooks = data.data
                })


            },
            //关闭打开选词框
            async selectWordCardBtn() {
                if (!this.control_selectword_div_state) {
                    //获取词书
                    await this.fetchBooks()
                    this.control_selectword_div_state = true
                } else {
                    this.selectWordControlState = 1
                    this.showTheBookOfWords = false
                    this.control_selectword_div_state = false
                    this.showWordItemParaphrase = false
                    this.selectedWordList = []
                }

            },
            //显示词库状态
            selectWordControlStateBtn(v) {
                this.selectWordControlState = v
                let select_word_control_state_1 = document.getElementById("select_word_control_state_1")
                let select_word_control_state_2 = document.getElementById("select_word_control_state_2")
                if (v == 1) {
                    if (!select_word_control_state_1.classList.contains("tip_example_control_span_focus")) {
                        select_word_control_state_1.classList.add("tip_example_control_span_focus")
                    }
                    if (select_word_control_state_2.classList.contains("tip_example_control_span_focus")) {
                        select_word_control_state_2.classList.remove("tip_example_control_span_focus")
                    }
                } else {
                    if (!select_word_control_state_2.classList.contains("tip_example_control_span_focus")) {
                        select_word_control_state_2.classList.add("tip_example_control_span_focus")
                    }
                    if (select_word_control_state_1.classList.contains("tip_example_control_span_focus")) {
                        select_word_control_state_1.classList.remove("tip_example_control_span_focus")
                    }
                }
            },
            //签到
            checkinBtn() {
                let _this = this
                axios({
                    method: 'post',
                    url: 'update/checkinDaily'
                }).then(function (data) {
                    if (data.data) {
                        _this.fetchDaily()  //获取学习进度
                        NotificationVue.showPublicNotification("success", "签到成功！");
                    } else {
                        NotificationVue.showPublicNotification("error", "发生未知错误，签到失败！");
                    }
                })
            },
            /*
            * 设置单词例句提示
            * */
            //设置例句提示按钮
            updateTipExampleBtn(exapid, en, cn) {
                let _this = this
                axios({
                    method: 'post',
                    url: 'update/updateStudyWordExample?wordid=' + _this.studyWord.wordid + '&exapid=' + exapid,
                }).then(function (data) {
                    if (data.data) {
                        _this.studyWord.example.en = en
                        _this.studyWord.example.cn = cn
                        _this.studyWord.exapid = exapid
                    } else {
                        NotificationVue.showPublicNotification("error", "出现位置错误，设置失败。");
                    }

                })
            },
            //打开关闭例句提示卡
            setTipExmaple() {
                if (!this.control_setexample_div_state) {
                    //获取例句
                    this.freshExample()
                    this.control_setexample_div_state = true
                } else
                    this.control_setexample_div_state = false
            },
            //控制例句显示状态
            tipExampleControlStateBtn(v) {
                this.tipExampleControlState = v
                let tip_example_control_state_1 = document.getElementById("tip_example_control_state_1")
                let tip_example_control_state_2 = document.getElementById("tip_example_control_state_2")
                if (v == 1) {
                    if (!tip_example_control_state_1.classList.contains("tip_example_control_span_focus")) {
                        tip_example_control_state_1.classList.add("tip_example_control_span_focus")
                    }
                    if (tip_example_control_state_2.classList.contains("tip_example_control_span_focus")) {
                        tip_example_control_state_2.classList.remove("tip_example_control_span_focus")
                    }
                } else {
                    if (!tip_example_control_state_2.classList.contains("tip_example_control_span_focus")) {
                        tip_example_control_state_2.classList.add("tip_example_control_span_focus")
                    }
                    if (tip_example_control_state_1.classList.contains("tip_example_control_span_focus")) {
                        tip_example_control_state_1.classList.remove("tip_example_control_span_focus")
                    }
                }
            },
            //添加热度
            heatBtn(exapid) {
                const itemToRemove = this.cardExampleList.find(item => item.exapid === exapid);
                itemToRemove.heat = itemToRemove.heat + 1
                axios({
                    method: 'get',
                    url: "update/addHeat?heat=" + itemToRemove.heat + "&exapid=" + exapid
                }).then(function (data) {
                    if (data.data)
                        NotificationVue.showPublicNotification("success", "成功为该例句增加热度。");
                    else
                        NotificationVue.showPublicNotification("error", "出现错误。");
                });

            },
            //获取所有例句
            freshExample() {
                const _this = this;
                axios({
                    method: 'get',
                    url: "search/findExamplesByWordId?wordid=" + _this.studyWord.wordid
                }).then(function (data) {
                    _this.cardExampleList = data.data;
                });
            },


            /*自定义书籍卡打开关闭按钮*/
            async controlUserBookBtn() {
                if (!this.control_userbook_div_state) {
                    await this.showMyUserBook()
                    this.all_add_detail_userbook = 0
                    this.control_userbook_div_state = true
                } else
                    this.control_userbook_div_state = false
            },
            /*从书籍删除该单词按钮*/
            deleteTheWordFormUserBookBtn(wordid, bookid) {
                MessageBoxVue.openMessageBox("你确定要将这个单词从这个词库删除吗？")
                let r = new Promise((resolve) => {
                    let timer = setInterval(() => {   //定时器
                        let messageBoxConfirmValue = window.sessionStorage.getItem("messageBoxConfirmValue")
                        if (messageBoxConfirmValue !== "null") {
                            clearInterval(timer)
                            resolve(messageBoxConfirmValue)
                        }
                    }, 100)
                })
                r.then(async (res) => {
                    if (res === "true") {  //删除例句
                        let v = await this.deleteTheWordFromUserBookAxios(wordid, bookid)
                        if (v) {
                            await this.getTheUserBookOfWords(bookid);
                            NotificationVue.showPublicNotification("success", "删除成功。")
                        } else {
                            NotificationVue.showPublicNotification("error", "发生未知错误，删除失败。")
                        }
                    }
                })

            },
            /*从书籍删除该单词axios*/
            async deleteTheWordFromUserBookAxios(wordid, bookid) {
                let result;
                await axios({
                    method: 'post',
                    url: "update/deleteWordFromUserBookMapper?wordid=" + wordid + "&bookid=" + bookid
                }).then(function (data) {
                    result = data.data
                });
                return result
            },
            /*跳转词库详情按钮*/
            async theUserBookDetailBtn(userbookid) {
                await this.getTheUserBookOfWords(userbookid);
                this.theUserBookDetail = this.alMyUserBooks.find(item => item.userbookid === userbookid);
                this.all_add_detail_userbook = 2
            },
            /*获取某词库的单词*/
            getTheUserBookOfWords(bookid) {
                const _this = this
                axios({
                    method: 'get',
                    url: "search/getUserBookOfAllWords?bookid=" + bookid
                }).then(function (data) {
                    _this.theUserBookOfAllWords = data.data
                });
            },
            /*加入该词到词库*/
            async addWordToUserBookBtn(userbookid) {
                const _this = this
                let value = false;
                await axios({
                    method: 'get',
                    url: "search/judgeTheWordInTheBook?wordid=" + _this.studyWord.wordid + "&bookid=" + userbookid
                }).then(function (data) {
                    value = data.data
                });
                if (value == false) {
                    axios({
                        method: 'post',
                        url: "update/addWordToUserBook?wordid=" + _this.studyWord.wordid + "&userbookid=" + userbookid
                    }).then(function (data) {
                        if (data.data = true)
                            NotificationVue.showPublicNotification("success", "添加成功！")
                        else
                            NotificationVue.showPublicNotification("success", "添加失败！")
                    });
                } else {
                    NotificationVue.showPublicNotification("error", "该单词已在这个词库里！")
                }
            },
            /*双开关按钮 私密或者公开*/
            switchBtn(v) {
                const switchBtnStatus_0 = document.getElementById("switchBtnStatus_0");
                const switchBtnStatus_1 = document.getElementById("switchBtnStatus_1");
                if (v !== this.public_privacy_status) {
                    if (v === 0) {
                        switchBtnStatus_0.classList.add("switch_btn_active")
                        switchBtnStatus_1.classList.remove("switch_btn_active")
                        this.public_privacy_status = 0
                    }
                    if (v === 1) {
                        switchBtnStatus_0.classList.remove("switch_btn_active")
                        switchBtnStatus_1.classList.add("switch_btn_active")
                        this.public_privacy_status = 1
                    }
                }
            },

            /*确认添加书籍按钮axios*/
            async addUserBookConfirmBtn() {
                const _this = this;
                await axios({
                    method: 'post',
                    url: "update/addUserBook?holderid=" + _this.userid + "&userbookname=" + _this.userbookname + "&bookdescribe=" + _this.bookdescribe + "&share=" + _this.public_privacy_status
                }).then(function (data) {
                    if (data.data === "NoUserBookName")
                        NotificationVue.showPublicNotification("error", "请填写词库名称。");
                    if (data.data === false)
                        NotificationVue.showPublicNotification("error", "发生未知错误，请稍后再试。")
                    if (data.data === true) {
                        NotificationVue.showPublicNotification("success", "添加成功")
                    }
                });
                _this.public_privacy_status = 0  //书籍属性
                _this.userbookname = ''  //书名
                _this.bookdescribe = ''  //简介
                _this.alreadyUserBookUpdate = true
            },
            /*显示我的所有云词本*/
            showMyUserBook() {
                const _this = this;
                axios({
                    method: 'get',
                    url: "search/allMyUserBooks?holderid=" + _this.userid
                }).then(function (data) {
                    _this.alMyUserBooks = data.data;
                });
            },
            /*添加云词库按钮*/
            addUserbookBtn() {
                this.all_add_detail_userbook = 1
            },
            /*自定义书籍返回按钮*/
            async userBookBackBtn() {
                if (this.alreadyUserBookUpdate) {
                    await this.showMyUserBook()
                    this.alreadyUserBookUpdate = false
                }
                this.all_add_detail_userbook = 0
                this.theUserBookOfAllWords = []

            },


            leftSortBtn(v) {
                let id_1 = window.document.getElementById("left_sort_1");
                let id_2 = document.getElementById("left_sort_2");
                let id_3 = document.getElementById("left_sort_3");
                if (v === 1) {
                    id_1.style.backgroundColor = "#00e57b"
                    id_1.style.color = "#000000"
                    id_2.style.backgroundColor = "#424242"
                    id_3.style.backgroundColor = "#424242"
                    id_2.style.color = "#efefef"
                    id_3.style.color = "#efefef"
                }
                if (v === 2) {

                    id_2.style.backgroundColor = "#ff9000"
                    id_2.style.color = "#000000"
                    id_1.style.backgroundColor = "#424242"
                    id_3.style.backgroundColor = "#424242"
                    id_1.style.color = "#efefef"
                    id_3.style.color = "#efefef"
                }
                if (v === 3) {
                    id_3.style.backgroundColor = "#ff0000"
                    id_3.style.color = "#000000"
                    id_1.style.backgroundColor = "#424242"
                    id_2.style.backgroundColor = "#424242"
                    id_1.style.color = "#efefef"
                    id_2.style.color = "#efefef"
                }
                this.studiedWordSortState = v
            },
            /*获取今日学习过的单词*/
            async getTadyStudiedWord() {
                let _this = this
                await axios({
                    method: 'get',
                    // url: 'update/feedbackStudyWord?quality=' + v
                    url: 'search/getTodayStudiedWords'
                }).then(function (data) {
                    _this.todayStudiedWords = data.data
                });
            },
            //fetchword时，不为空v=true ，nextWord v=false
            totalStudyTimerFresh(v) {
                let _this = this
                if (v) { //计时器启动
                    _this.totalStudyTime = 0
                    _this.totalStudyTimer = setInterval(() => {   //定时器
                        _this.totalStudyTime++
                    }, 100);
                } else {
                    clearInterval(_this.totalStudyTimer)
                }

            },
            nextWord(v) {
                let _this = this
                this.totalStudyTimerFresh(false)  //计时结束
                axios({
                    method: 'post',
                    // url: 'update/feedbackStudyWord?quality=' + v
                    url: 'update/feedbackStudyWord?wordid=' + _this.studyWord.wordid + '&quality=' + v + '&dayStudyCount=' + _this.studyWord.day_studycount + '&difficulty=' + _this.studyWord.word.difficulty + "&totalStudyTime=" + _this.totalStudyTime
                }).then(function (data) {
                    if (data.data) {
                        _this.fetchStudyWord()
                    } else {
                        NotificationVue.showPublicNotification("error", "抱歉系统发生了未知错误，请稍后再试。")
                    }
                });


                //获取下一个单词
            },
            qualityBtn(v) {
                this.qualityState = v
            },
            nextWordBtn() {
                let _this = this
                let nextWordFrames = document.getElementsByClassName("nextWordFrames")[0];
                let next_word_div = document.getElementsByClassName("next_word_div")[0];
                if (this.downState === false) {
                    this.downState = true
                    next_word_div.style.color = "#ffffff"
                    nextWordFrames.style.backgroundColor = "#00e57b"
                    nextWordFrames.style.animation = "nextWordFrames 0.5s linear"
                    next_word_div.style.border = "1px #00e57b solid"
                    let timer = setInterval(() => {   //定时器
                        if (_this.downState === false) {
                            clearInterval(timer)
                            _this.nextWordCancelBtn()
                        } else {
                            _this.downTime++
                            if (_this.downTime >= 50) {
                                _this.nextWordCancelBtn()
                                clearInterval(timer)
                                _this.thinkingOrNot = false  //释义

                            }
                        }
                    }, 10)
                }

            },
            stackChart() {
                let _this = this
                const myChart = echarts.init(document.getElementById('stackChart'));
                window.addEventListener('resize', function () {
                    myChart.resize();
                });
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            // Use axis to trigger tooltip
                            type: 'shadow' // 'shadow' as default; can also be 'line' or 'shadow'
                        },
                    },
                    legend: {
                        textStyle: {
                            color: '#ffffff',  //更改坐标轴文字颜色
                            fontSize: 12      //更改坐标轴文字大小
                        }
                    },
                    grid: {
                        left: '3%',
                        right: '3%',
                        bottom: '0%',
                        top: '25%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            textStyle: {
                                color: '#ffffff',  //更改坐标轴文字颜色
                                fontSize: 12      //更改坐标轴文字大小
                            }
                        }
                    },
                    yAxis: {
                        type: 'category',
                        data: ['今天'],
                        axisLabel: {
                            show: true,
                            textStyle: {
                                color: '#ffffff',  //更改坐标轴文字颜色
                                fontSize: 12      //更改坐标轴文字大小
                            }
                        }
                    },
                    series: [
                        {
                            itemStyle: {
                                color: '#00e57b',
                            },
                            name: '了如指掌',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [0]
                        },
                        {
                            itemStyle: {
                                color: '#50a7ff',
                            },
                            name: '恍然大悟',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [_this.studyWord.day_q_2]
                        },
                        {
                            name: '模模糊糊',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [_this.studyWord.day_q_1],
                            itemStyle: {
                                color: '#ff9000',
                            }
                        },
                        {
                            name: '茫无所知',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [_this.studyWord.day_q_0],
                            itemStyle: {
                                color: '#ff0000',
                            }
                        }
                    ]
                };
                option && myChart.setOption(option);
            },
            stackStudiedChart(v) {
                let q_3 = v.length
                let q_2 = 0
                let q_1 = 0
                let q_0 = 0
                for (let i = 0; i < v.length; i++) {
                    q_2 = q_2 + v[i].day_q_2
                    q_1 = q_1 + v[i].day_q_1
                    q_0 = q_0 + v[i].day_q_0
                }
                let _this = this
                const myChart = echarts.init(document.getElementById('stackStudiedChart'));
                window.addEventListener('resize', function () {
                    myChart.resize();
                });
                const option = {
                    title: {
                        text: '今日学习反馈记录',
                        textStyle: {
                            color: '#ffffff',  //更改坐标轴文字颜色
                            fontSize: 17      //更改坐标轴文字大小
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            // Use axis to trigger tooltip
                            type: 'shadow' // 'shadow' as default; can also be 'line' or 'shadow'
                        },
                    },
                    legend: {
                        textStyle: {
                            color: '#ffffff',  //更改坐标轴文字颜色
                            fontSize: 12      //更改坐标轴文字大小
                        }
                    },
                    grid: {
                        left: '3%',
                        right: '3%',
                        bottom: '0%',
                        top: '25%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        axisLabel: {
                            show: true,
                            textStyle: {
                                color: '#ffffff',  //更改坐标轴文字颜色
                                fontSize: 12      //更改坐标轴文字大小
                            }
                        }
                    },
                    yAxis: {
                        type: 'category',
                        data: ['次数'],
                        axisLabel: {
                            show: true,
                            textStyle: {
                                color: '#ffffff',  //更改坐标轴文字颜色
                                fontSize: 12      //更改坐标轴文字大小
                            }
                        }
                    },
                    series: [
                        {
                            itemStyle: {
                                color: '#00e57b',
                            },
                            name: '了如指掌',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [q_3]
                        },
                        {
                            itemStyle: {
                                color: '#50a7ff',
                            },
                            name: '恍然大悟',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [q_2]
                        },
                        {
                            name: '模模糊糊',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [q_1],
                            itemStyle: {
                                color: '#ff9000',
                            }
                        },
                        {
                            name: '茫无所知',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [q_0],
                            itemStyle: {
                                color: '#ff0000',
                            }
                        }
                    ]
                };
                option && myChart.setOption(option);

            },
            nextWordCancelBtn() {
                this.downTime = 0
                this.downState = false
                let nextWordFrames = document.getElementsByClassName("nextWordFrames")[0];
                let next_word_div = document.getElementsByClassName("next_word_div")[0];
                next_word_div.style.color = "#1a1a1a"
                nextWordFrames.style.backgroundColor = "#1a1a1a"
                nextWordFrames.style.animation = "none"
                next_word_div.style.border = "1px #1a1a1a solid"
            },
            exampleEnded() {
                let example_audio_btn = document.getElementsByClassName("example_audio_btn")[0];
                example_audio_btn.style.backgroundImage = "url('image/index-01/pause_audio.png')"
            },
            playExampleAudio() {
                let example_audio_btn = document.getElementsByClassName("example_audio_btn")[0];
                let example_audio = document.getElementById("example_audio");
                if (example_audio.paused) {
                    example_audio.currentTime = 0
                    example_audio.play()
                    example_audio_btn.style.backgroundImage = "url('image/index-01/play_audio.png')"
                } else {
                    example_audio.pause()
                    example_audio_btn.style.backgroundImage = "url('image/index-01/pause_audio.png')"
                }

            },
            playExampleAudioParaphrase() {
                let example_audio_btn = document.getElementsByClassName("example_audio_btn")[0];
                let example_audio_paraphrase = document.getElementById("example_audio_paraphrase");
                if (example_audio_paraphrase.paused) {
                    example_audio_paraphrase.currentTime = 0
                    example_audio_paraphrase.play()
                    example_audio_btn.style.backgroundImage = "url('image/index-01/play_audio.png')"
                } else {
                    example_audio_paraphrase.pause()
                    example_audio_btn.style.backgroundImage = "url('image/index-01/pause_audio.png')"
                }

            },
            playAudio(a) {
                var id = a.currentTarget.id;
                if (id === "UK_audio_btn") {
                    // USA_audio.pause()
                    const UK_audio = document.getElementById("UK_audio");
                    UK_audio.play()
                }
                if (id === "USA_audio_btn") {
                    const USA_audio = document.getElementById("USA_audio");
                    // UK_audio.pause()
                    USA_audio.play()
                }
                if (id === "UK_audio_btn_paraphrase") {
                    const UK_audio_paraphrase = document.getElementById("UK_audio_paraphrase");
                    // UK_audio.pause()
                    UK_audio_paraphrase.play()
                }
                if (id === "USA_audio_btn_paraphrase") {
                    const USA_audio_paraphrase = document.getElementById("USA_audio_paraphrase");
                    // UK_audio.pause()
                    USA_audio_paraphrase.play()
                }


            },
            highLightWord(text) {
                if (text.includes(this.studyWord.word.spelling)) {
                    text = text.replace(
                        this.studyWord.word.spelling,
                        // 这里是替换成html格式的数据，最好再加一个样式权重，保险一点
                        '<span style="color:#00e57b!important;">' + this.studyWord.word.spelling + '</span>'
                    )
                    return text
                } else {
                    return text
                }
            },
            alreadyKnownBtn() {
                MessageBoxVue.openMessageBox("标记熟知后，该词将不会安排再次复习，并马上进入下一个单词的学习。");
                let r = new Promise((resolve) => {
                    let timer = setInterval(() => {   //定时器
                        let messageBoxConfirmValue = window.sessionStorage.getItem("messageBoxConfirmValue")
                        if (messageBoxConfirmValue !== "null") {
                            clearInterval(timer)
                            resolve(messageBoxConfirmValue)
                        }
                    }, 100)
                })
                r.then(async (res) => {
                    if (res === "true") {
                        await this.setStudyWordState(1)
                    }
                })
            },
            /*设置熟知*/
            setStudyWordState(v) {
                let _this = this
                axios({
                    method: 'post',
                    url: 'update/setStudyWordState?state=' + v + '&wordid=' + _this.studyWord.wordid
                }).then(function (data) {
                    if (data.data === true) {
                        _this.fetchStudyWord()  //获取下一个单词
                        NotificationVue.showPublicNotification("success", "已将该单词标记为熟知单词。");
                    } else {
                        NotificationVue.showPublicNotification("error", "发生未知错误。");
                    }
                })
            },
            /*删除学习计划*/
            deleteStudyWordPlanningBtn() {
                MessageBoxVue.openMessageBox("移除学习规划将删除你学习该单词的所有学习数据，并进入下一个单词的学习。");
                let r = new Promise((resolve) => {
                    let timer = setInterval(() => {   //定时器
                        let messageBoxConfirmValue = window.sessionStorage.getItem("messageBoxConfirmValue")
                        if (messageBoxConfirmValue !== "null") {
                            clearInterval(timer)
                            resolve(messageBoxConfirmValue)
                        }
                    }, 100)
                })
                r.then(async (res) => {
                    if (res === "true") {  //删除
                        this.deleteStudyWord()
                    }
                })

            },
            deleteStudyWord() {
                let _this = this
                axios({
                    method: 'post',
                    url: 'update/deleteTheStudyWord?wordid=' + _this.studyWord.wordid,
                }).then(function (data) {
                    if (data.data === true) {
                        NotificationVue.showPublicNotification("success", "移除成功。")
                        _this.fetchStudyWord()  //获取下一个单词
                    } else {
                        NotificationVue.showPublicNotification("error", "发生未知错误，删除失败。")
                    }
                })
            },
            datedifference(sDate1, sDate2) {    //sDate1现在的时间  sDate2下次时间
                let dateSpan, tempDate, iDays
                sDate1 = Date.parse(sDate1)
                sDate2 = Date.parse(sDate2)
                dateSpan = sDate2 - sDate1
                iDays = Math.floor(dateSpan / (24 * 3600 * 1000))
                return iDays
            },
            async fetchStudyWord() {
                let _this = this
                await axios({
                    method: "get",
                    url: "search/getTodayStudyWord"
                }).then(function (data) {
                    _this.studyWord = data.data
                })
                if (this.studyWord.length !== 0) {
                    this.studyWord.intervalday = this.datedifference(this.getNowDate(), this.studyWord.nextstudydate);
                    this.oneWordThinkTime = 0
                    if (this.studyWord.laststudydate !== this.getNowDate()) {  //今天第一次记这个单词单词
                        this.studyWord.day_q_0 = 0
                        this.studyWord.day_q_1 = 0
                        this.studyWord.day_q_2 = 0
                        this.studyWord.day_studycount = 0
                    }
                    await this.fetchDaily()  //获取学习进度
                    this.audio_type1 = "http://dict.youdao.com/dictvoice?type=1&audio=" + this.studyWord.word.spelling;
                    this.audio_type2 = "http://dict.youdao.com/dictvoice?type=2&audio=" + this.studyWord.word.spelling;
                    this.audio_example = "http://dict.youdao.com/dictvoice?type=2&audio=" + this.studyWord.example.en;
                    this.studyingOrNot = true  //还有单词为学，显示学习页面
                    this.thinkingOrNot = true   //思考页面
                    this.totalStudyTimerFresh(true)  //计时启动
                } else {
                    this.studyingOrNot = false   //没有单词可学
                    this.thinkingOrNot = false
                    await this.fetchDaily()  //获取学习进度
                    await this.getTadyStudiedWord()  //获取今日学习的单词
                    this.stackStudiedChart(this.todayStudiedWords)
                }


            },
            async fetchDaily() {
                let _this = this
                await axios({
                    method: "get",
                    url: "search/getDaily"
                }).then(function (data) {
                    _this.daily = data.data
                })
                let temp = this.daily.studyword / this.daily.shouldstudy * 100
                if (temp <= 2 && temp > 0)
                    this.tittleGreenWidth = 2
                else if (temp >= 98 && temp < 100)
                    this.tittleGreenWidth = 98
                else {
                    this.tittleGreenWidth = temp
                }

            },
            getNowDate() {
                let date = new Date()
                return (date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate()).toString()
            },
            /*打卡完成时使用*/
            getNowDateFilter() {
                let date = new Date()
                return (date.getFullYear() + '年' + (date.getMonth() + 1) + '月' + date.getDate() + '日').toString()
            },
            timeCount(time) {
                if (time > 600) {
                    return Math.floor(time / 600) + '分' + Math.floor((time % 600) / 10) + '秒'
                } else {
                    return Math.ceil(time / 10) + '秒'
                }
            },
            /*跳转到单词详情*/
            theWordDetail(wordid) {
                sessionStorage.setItem("wordid", wordid);
                sessionStorage.setItem("backFromWordDetailPageValue", "index_01");
                axios({
                    method: 'post',
                    url: 'update/addSearchTimes?wordid=' + wordid,
                }).then(function (data) {
                    window.location.assign('wordDetailPage?wordid=' + wordid);
                })
            },
            fetchUserId() {
                const _this = this;
                axios({
                    method: "get",
                    url: "search/getUserId"
                }).then(function (data) {
                    _this.userid = data.data
                })
            },

        },

    })


    const NotificationVue = new Vue({
        el: "#notification",
        data: {
            no_content: '',
            no_type: '',   //error，message消息，warn警告,success成功
            timer: null,
            spantype: {
                error: {
                    value: '失败',
                    src: 'image/public_notification/error.png'
                },
                message: {
                    value: '消息',
                    src: 'image/public_notification/message.png'
                },
                success: {
                    value: '成功',
                    src: 'image/public_notification/success.png'
                },
                warn: {
                    value: '警告',
                    src: 'image/public_notification/warn.png'
                },
            }
        },
        methods: {
            showPublicNotification(type, content) {
                if (this.timer) { //计时器已经存在则销毁
                    clearTimeout(this.timer)
                    this.timer = null
                }
                const id = document.getElementById("notification")
                id.style.right = "30px";
                this.no_content = content
                this.no_type = type
                this.timer = setTimeout(() => {
                    this.no_content = ''
                    this.no_type = ''
                    id.style.right = "-300px"
                }, 3000)
            }
        },
    })
    /*弹窗*/
    const MessageBoxVue = new Vue({
        el: "#MessageBoxContent",
        data: {
            messageBoxQuestion: "",
            borderFramesValue: false
        },
        methods: {
            /*public确认还是取消按钮并关闭弹窗*/
            messageBoxConfirmBtn(v) {
                window.sessionStorage.setItem("messageBoxConfirmValue", v);
                //关闭弹窗
                // let messageBox = document.getElementById("messageBox");
                let MessageBoxContent = document.getElementById("MessageBoxContent");
                MessageBoxContent.style.display = "none"
                // messageBox.style.marginTop = "-200px";
                let m = function (e) {
                    e.preventDefault();
                };
                document.body.style.overflow = '';
                document.addEventListener('touchmove', m, {passive: true});//禁止页面滑动
            },
            /*打开弹窗 其他vue实例使用*/
            openMessageBox(content) {
                let m = function (e) {
                    e.preventDefault();
                };
                document.body.style.overflow = 'hidden';
                document.addEventListener('touchmove', m, {passive: false});//禁止页面滑动
                sessionStorage.setItem("messageBoxConfirmValue", "null");
                this.messageBoxQuestion = content
                // this.functionName = functionName
                // let messageBox = document.getElementById("messageBox");
                let MessageBoxContent = document.getElementById("MessageBoxContent");
                MessageBoxContent.style.display = "flex"
                // messageBox.style.marginTop = "20px";
            },
            tipEffection() {
                this.borderFramesValue = true
            },
            tipEffectionEnd() {
                this.borderFramesValue = false
            },

        }
    })
</script>

</body>
</html>
